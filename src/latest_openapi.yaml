openapi: 3.1.0
info:
  title: Substrate API
  description: |
    Substrate is an architectural governance platform that continuously monitors
    the alignment between documented intent and actual implementation.
    
    ## Architecture Notes
    This API serves as the unified gateway for all Substrate operations. Backend services
    (Ingestion, GraphRAG, Governance, Maintenance) communicate internally via gRPC and NATS.
    Direct database access (PostgreSQL, Neo4j, Qdrant) is encapsulated within services —
    this spec exposes only the REST interface for frontend and external integrations.
  version: 2.0.0
  contact:
    name: Substrate Platform Team
    email: platform@substrate.io
  license:
    name: Proprietary
    url: https://substrate.io/license

servers:
  - url: http://localhost:8080/api/v1
    description: Local development
  - url: https://api.substrate.io/v1
    description: Production
  - url: https://{tenant}.api.substrate.io/v1
    description: Tenant-specific
    variables:
      tenant:
        default: demo
        description: Tenant subdomain

security:
  - BearerAuth: []
  - ApiKeyAuth: []

tags:
  - name: Auth
    description: Authentication and session management
  - name: Organizations
    description: Organization (tenant) management
  - name: Teams
    description: Team management within organizations
  - name: Projects
    description: Project and workspace management
  - name: Users
    description: User management and profiles
  - name: Knowledge Fabric
    description: Entity and relationship management (graph abstraction)
  - name: GraphRAG
    description: Semantic querying and community analysis
  - name: Governance
    description: Policy management and violation tracking
  - name: Marketplace
    description: Plugin discovery, installation, and management
  - name: Connectors
    description: Data source connections and sync management
  - name: Quality Metrics
    description: Architectural health, drift, and DORA metrics
  - name: Maintenance
    description: Staleness detection, duplicates, and review queue
  - name: Settings
    description: Platform configuration and preferences
  - name: Webhooks
    description: Outbound webhook management
  - name: Audit
    description: Audit logs and activity tracking

paths:
  # ═══════════════════════════════════════════════════════════════════════════
  # AUTH
  # ═══════════════════════════════════════════════════════════════════════════
  /auth/login:
    post:
      tags: [Auth]
      summary: Login with credentials
      operationId: login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/login/sso:
    post:
      tags: [Auth]
      summary: Initiate SSO login
      operationId: initiateSSOLogin
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [provider]
              properties:
                provider:
                  type: string
                  enum: [okta, azure-ad, google, saml]
                redirectUri:
                  type: string
                  format: uri
      responses:
        '200':
          description: SSO redirect URL
          content:
            application/json:
              schema:
                type: object
                properties:
                  authorizationUrl:
                    type: string
                    format: uri
                  state:
                    type: string

  /auth/callback:
    post:
      tags: [Auth]
      summary: SSO callback handler
      operationId: handleSSOCallback
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [code, state]
              properties:
                code:
                  type: string
                state:
                  type: string
      responses:
        '200':
          description: SSO login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

  /auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh access token
      operationId: refreshToken
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refreshToken]
              properties:
                refreshToken:
                  type: string
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout and invalidate tokens
      operationId: logout
      responses:
        '204':
          description: Logged out successfully

  /auth/me:
    get:
      tags: [Auth]
      summary: Get current user
      operationId: getCurrentUser
      responses:
        '200':
          description: Current user details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /auth/mfa/setup:
    post:
      tags: [Auth]
      summary: Setup MFA
      operationId: setupMFA
      responses:
        '200':
          description: MFA setup details
          content:
            application/json:
              schema:
                type: object
                properties:
                  secret:
                    type: string
                  qrCodeUri:
                    type: string
                  backupCodes:
                    type: array
                    items:
                      type: string

  /auth/mfa/verify:
    post:
      tags: [Auth]
      summary: Verify MFA code
      operationId: verifyMFA
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [code]
              properties:
                code:
                  type: string
                  pattern: '^\d{6}$'
      responses:
        '200':
          description: MFA verified
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ═══════════════════════════════════════════════════════════════════════════
  # ORGANIZATIONS
  # ═══════════════════════════════════════════════════════════════════════════
  /organizations:
    get:
      tags: [Organizations]
      summary: List organizations (super-admin only)
      operationId: listOrganizations
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: search
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Organization list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrganizationListResponse'
    post:
      tags: [Organizations]
      summary: Create organization
      operationId: createOrganization
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrganizationRequest'
      responses:
        '201':
          description: Organization created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Organization'

  /organizations/{orgId}:
    get:
      tags: [Organizations]
      summary: Get organization details
      operationId: getOrganization
      parameters:
        - $ref: '#/components/parameters/OrgIdParam'
      responses:
        '200':
          description: Organization details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Organization'
    patch:
      tags: [Organizations]
      summary: Update organization
      operationId: updateOrganization
      parameters:
        - $ref: '#/components/parameters/OrgIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOrganizationRequest'
      responses:
        '200':
          description: Organization updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Organization'
    delete:
      tags: [Organizations]
      summary: Delete organization
      operationId: deleteOrganization
      parameters:
        - $ref: '#/components/parameters/OrgIdParam'
      responses:
        '204':
          description: Organization deleted

  /organizations/{orgId}/members:
    get:
      tags: [Organizations]
      summary: List organization members
      operationId: listOrgMembers
      parameters:
        - $ref: '#/components/parameters/OrgIdParam'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Member list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrgMemberListResponse'
    post:
      tags: [Organizations]
      summary: Invite member to organization
      operationId: inviteOrgMember
      parameters:
        - $ref: '#/components/parameters/OrgIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InviteMemberRequest'
      responses:
        '201':
          description: Invitation sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrgMember'

  /organizations/{orgId}/members/{userId}:
    patch:
      tags: [Organizations]
      summary: Update member role
      operationId: updateOrgMemberRole
      parameters:
        - $ref: '#/components/parameters/OrgIdParam'
        - $ref: '#/components/parameters/UserIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [role]
              properties:
                role:
                  $ref: '#/components/schemas/OrgRole'
      responses:
        '200':
          description: Role updated
    delete:
      tags: [Organizations]
      summary: Remove member from organization
      operationId: removeOrgMember
      parameters:
        - $ref: '#/components/parameters/OrgIdParam'
        - $ref: '#/components/parameters/UserIdParam'
      responses:
        '204':
          description: Member removed

  /organizations/{orgId}/sso:
    get:
      tags: [Organizations]
      summary: Get SSO configuration
      operationId: getOrgSSOConfig
      parameters:
        - $ref: '#/components/parameters/OrgIdParam'
      responses:
        '200':
          description: SSO configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SSOConfig'
    put:
      tags: [Organizations]
      summary: Update SSO configuration
      operationId: updateOrgSSOConfig
      parameters:
        - $ref: '#/components/parameters/OrgIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SSOConfig'
      responses:
        '200':
          description: SSO configuration updated

  /organizations/{orgId}/billing:
    get:
      tags: [Organizations]
      summary: Get billing information
      operationId: getOrgBilling
      parameters:
        - $ref: '#/components/parameters/OrgIdParam'
      responses:
        '200':
          description: Billing information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BillingInfo'

  /organizations/{orgId}/usage:
    get:
      tags: [Organizations]
      summary: Get usage statistics
      operationId: getOrgUsage
      parameters:
        - $ref: '#/components/parameters/OrgIdParam'
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Usage statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsageStats'

  /organizations/{orgId}/quotas:
    get:
      tags: [Organizations]
      summary: Get organization quotas
      operationId: getOrgQuotas
      parameters:
        - $ref: '#/components/parameters/OrgIdParam'
      responses:
        '200':
          description: Quota information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuotaInfo'

  /organizations/{orgId}/invitations:
    get:
      tags: [Organizations]
      summary: List pending invitations
      operationId: listOrgInvitations
      parameters:
        - $ref: '#/components/parameters/OrgIdParam'
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, accepted, expired, cancelled]
      responses:
        '200':
          description: Invitations list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvitationListResponse'

  /organizations/{orgId}/invitations/{invitationId}:
    delete:
      tags: [Organizations]
      summary: Cancel/revoke invitation
      operationId: cancelInvitation
      parameters:
        - $ref: '#/components/parameters/OrgIdParam'
        - name: invitationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Invitation cancelled

  /organizations/{orgId}/invitations/{invitationId}/resend:
    post:
      tags: [Organizations]
      summary: Resend invitation email
      operationId: resendInvitation
      parameters:
        - $ref: '#/components/parameters/OrgIdParam'
        - name: invitationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Invitation resent

  # ═══════════════════════════════════════════════════════════════════════════
  # TEAMS
  # ═══════════════════════════════════════════════════════════════════════════
  /teams:
    get:
      tags: [Teams]
      summary: List teams in organization
      operationId: listTeams
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: search
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Team list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TeamListResponse'
    post:
      tags: [Teams]
      summary: Create team
      operationId: createTeam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTeamRequest'
      responses:
        '201':
          description: Team created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Team'

  /teams/{teamId}:
    get:
      tags: [Teams]
      summary: Get team details
      operationId: getTeam
      parameters:
        - $ref: '#/components/parameters/TeamIdParam'
      responses:
        '200':
          description: Team details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Team'
    patch:
      tags: [Teams]
      summary: Update team
      operationId: updateTeam
      parameters:
        - $ref: '#/components/parameters/TeamIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTeamRequest'
      responses:
        '200':
          description: Team updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Team'
    delete:
      tags: [Teams]
      summary: Delete team
      operationId: deleteTeam
      parameters:
        - $ref: '#/components/parameters/TeamIdParam'
      responses:
        '204':
          description: Team deleted

  /teams/{teamId}/members:
    get:
      tags: [Teams]
      summary: List team members
      operationId: listTeamMembers
      parameters:
        - $ref: '#/components/parameters/TeamIdParam'
      responses:
        '200':
          description: Member list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TeamMemberListResponse'
    post:
      tags: [Teams]
      summary: Add member to team
      operationId: addTeamMember
      parameters:
        - $ref: '#/components/parameters/TeamIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [userId, role]
              properties:
                userId:
                  type: string
                  format: uuid
                role:
                  $ref: '#/components/schemas/TeamRole'
      responses:
        '201':
          description: Member added

  /teams/{teamId}/members/{userId}:
    patch:
      tags: [Teams]
      summary: Update team member role
      operationId: updateTeamMemberRole
      parameters:
        - $ref: '#/components/parameters/TeamIdParam'
        - $ref: '#/components/parameters/UserIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [role]
              properties:
                role:
                  $ref: '#/components/schemas/TeamRole'
      responses:
        '200':
          description: Role updated
    delete:
      tags: [Teams]
      summary: Remove member from team
      operationId: removeTeamMember
      parameters:
        - $ref: '#/components/parameters/TeamIdParam'
        - $ref: '#/components/parameters/UserIdParam'
      responses:
        '204':
          description: Member removed

  /teams/{teamId}/ownership:
    get:
      tags: [Teams]
      summary: Get entities owned by team
      operationId: getTeamOwnership
      parameters:
        - $ref: '#/components/parameters/TeamIdParam'
        - name: entityType
          in: query
          schema:
            $ref: '#/components/schemas/EntityType'
      responses:
        '200':
          description: Owned entities
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EntityListResponse'

  /teams/{teamId}/metrics:
    get:
      tags: [Teams]
      summary: Get team metrics
      description: Returns team-level metrics including violations, documentation coverage, and health score
      operationId: getTeamMetrics
      parameters:
        - $ref: '#/components/parameters/TeamIdParam'
      responses:
        '200':
          description: Team metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TeamMetrics'

  # ═══════════════════════════════════════════════════════════════════════════
  # PROJECTS
  # ═══════════════════════════════════════════════════════════════════════════
  /projects:
    get:
      tags: [Projects]
      summary: List projects
      operationId: listProjects
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: teamId
          in: query
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            type: string
            enum: [active, archived, draft]
      responses:
        '200':
          description: Project list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectListResponse'
    post:
      tags: [Projects]
      summary: Create project
      operationId: createProject
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectRequest'
      responses:
        '201':
          description: Project created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'

  /projects/{projectId}:
    get:
      tags: [Projects]
      summary: Get project details
      operationId: getProject
      parameters:
        - $ref: '#/components/parameters/ProjectIdParam'
      responses:
        '200':
          description: Project details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
    patch:
      tags: [Projects]
      summary: Update project
      operationId: updateProject
      parameters:
        - $ref: '#/components/parameters/ProjectIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProjectRequest'
      responses:
        '200':
          description: Project updated
    delete:
      tags: [Projects]
      summary: Delete project
      operationId: deleteProject
      parameters:
        - $ref: '#/components/parameters/ProjectIdParam'
      responses:
        '204':
          description: Project deleted

  /projects/{projectId}/archive:
    post:
      tags: [Projects]
      summary: Archive project
      operationId: archiveProject
      parameters:
        - $ref: '#/components/parameters/ProjectIdParam'
      responses:
        '200':
          description: Project archived

  /projects/{projectId}/unarchive:
    post:
      tags: [Projects]
      summary: Unarchive project
      operationId: unarchiveProject
      parameters:
        - $ref: '#/components/parameters/ProjectIdParam'
      responses:
        '200':
          description: Project unarchived

  /projects/{projectId}/entities:
    get:
      tags: [Projects]
      summary: Get entities in project scope
      operationId: getProjectEntities
      parameters:
        - $ref: '#/components/parameters/ProjectIdParam'
        - name: entityType
          in: query
          schema:
            $ref: '#/components/schemas/EntityType'
      responses:
        '200':
          description: Project entities
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EntityListResponse'

  /projects/{projectId}/connections:
    get:
      tags: [Projects]
      summary: Get connections associated with project
      operationId: getProjectConnections
      parameters:
        - $ref: '#/components/parameters/ProjectIdParam'
      responses:
        '200':
          description: Project connections
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConnectionListResponse'
    post:
      tags: [Projects]
      summary: Associate connection with project
      operationId: addProjectConnection
      parameters:
        - $ref: '#/components/parameters/ProjectIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [connectionId]
              properties:
                connectionId:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Connection associated

  /projects/{projectId}/connections/{connectionId}:
    delete:
      tags: [Projects]
      summary: Remove connection from project
      operationId: removeProjectConnection
      parameters:
        - $ref: '#/components/parameters/ProjectIdParam'
        - $ref: '#/components/parameters/ConnectionIdParam'
      responses:
        '204':
          description: Connection removed

  /projects/{projectId}/policies:
    get:
      tags: [Projects]
      summary: Get policies scoped to project
      operationId: getProjectPolicies
      parameters:
        - $ref: '#/components/parameters/ProjectIdParam'
      responses:
        '200':
          description: Project policies
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PolicyListResponse'

  /projects/{projectId}/health:
    get:
      tags: [Projects]
      summary: Get project health score
      operationId: getProjectHealth
      parameters:
        - $ref: '#/components/parameters/ProjectIdParam'
      responses:
        '200':
          description: Project health
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthScore'

  # ═══════════════════════════════════════════════════════════════════════════
  # USERS
  # ═══════════════════════════════════════════════════════════════════════════
  /users:
    get:
      tags: [Users]
      summary: List users
      operationId: listUsers
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: search
          in: query
          schema:
            type: string
        - name: role
          in: query
          schema:
            $ref: '#/components/schemas/UserRole'
        - name: teamId
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserListResponse'
    post:
      tags: [Users]
      summary: Create user
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /users/{userId}:
    get:
      tags: [Users]
      summary: Get user details
      operationId: getUser
      parameters:
        - $ref: '#/components/parameters/UserIdParam'
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
    patch:
      tags: [Users]
      summary: Update user
      operationId: updateUser
      parameters:
        - $ref: '#/components/parameters/UserIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: User updated
    delete:
      tags: [Users]
      summary: Deactivate user
      operationId: deactivateUser
      parameters:
        - $ref: '#/components/parameters/UserIdParam'
      responses:
        '204':
          description: User deactivated

  /users/{userId}/api-keys:
    get:
      tags: [Users]
      summary: List user API keys
      operationId: listUserApiKeys
      parameters:
        - $ref: '#/components/parameters/UserIdParam'
      responses:
        '200':
          description: API key list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiKeyListResponse'
    post:
      tags: [Users]
      summary: Create API key
      operationId: createApiKey
      parameters:
        - $ref: '#/components/parameters/UserIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateApiKeyRequest'
      responses:
        '201':
          description: API key created (secret shown once)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiKeyWithSecret'

  /users/{userId}/api-keys/{keyId}:
    delete:
      tags: [Users]
      summary: Revoke API key
      operationId: revokeApiKey
      parameters:
        - $ref: '#/components/parameters/UserIdParam'
        - name: keyId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: API key revoked

  # ═══════════════════════════════════════════════════════════════════════════
  # KNOWLEDGE FABRIC
  # ═══════════════════════════════════════════════════════════════════════════
  /entities:
    get:
      tags: [Knowledge Fabric]
      summary: List entities
      operationId: listEntities
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: type
          in: query
          schema:
            $ref: '#/components/schemas/EntityType'
        - name: source
          in: query
          schema:
            type: string
            description: Filter by data source (e.g., github, jira)
        - name: search
          in: query
          schema:
            type: string
        - name: teamId
          in: query
          schema:
            type: string
            format: uuid
        - name: projectId
          in: query
          schema:
            type: string
            format: uuid
        - name: health
          in: query
          schema:
            $ref: '#/components/schemas/HealthStatus'
      responses:
        '200':
          description: Paginated entity list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EntityListResponse'
    post:
      tags: [Knowledge Fabric]
      summary: Create entity manually
      operationId: createEntity
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEntityRequest'
      responses:
        '201':
          description: Entity created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Entity'

  /entities/{entityId}:
    get:
      tags: [Knowledge Fabric]
      summary: Get entity details
      operationId: getEntity
      parameters:
        - $ref: '#/components/parameters/EntityIdParam'
      responses:
        '200':
          description: Entity details with metadata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EntityDetail'
        '404':
          $ref: '#/components/responses/NotFound'
    patch:
      tags: [Knowledge Fabric]
      summary: Update entity
      operationId: updateEntity
      parameters:
        - $ref: '#/components/parameters/EntityIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEntityRequest'
      responses:
        '200':
          description: Entity updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Entity'
    delete:
      tags: [Knowledge Fabric]
      summary: Delete entity
      operationId: deleteEntity
      parameters:
        - $ref: '#/components/parameters/EntityIdParam'
      responses:
        '204':
          description: Entity deleted

  /entities/{entityId}/relationships:
    get:
      tags: [Knowledge Fabric]
      summary: Get entity relationships
      operationId: getEntityRelationships
      parameters:
        - $ref: '#/components/parameters/EntityIdParam'
        - name: direction
          in: query
          schema:
            type: string
            enum: [inbound, outbound, both]
            default: both
        - name: type
          in: query
          schema:
            $ref: '#/components/schemas/RelationshipType'
        - name: maxHops
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 5
            default: 1
      responses:
        '200':
          description: Relationship graph
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipGraphResponse'

  /entities/{entityId}/context:
    get:
      tags: [Knowledge Fabric]
      summary: Get entity context subgraph
      operationId: getEntityContext
      parameters:
        - $ref: '#/components/parameters/EntityIdParam'
        - name: maxHops
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 3
            default: 2
      responses:
        '200':
          description: Context subgraph for visualization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContextGraphResponse'

  /entities/{entityId}/history:
    get:
      tags: [Knowledge Fabric]
      summary: Get entity change history
      operationId: getEntityHistory
      parameters:
        - $ref: '#/components/parameters/EntityIdParam'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Entity history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EntityHistoryResponse'

  /entities/{entityId}/violations:
    get:
      tags: [Knowledge Fabric]
      summary: Get violations for entity
      operationId: getEntityViolations
      parameters:
        - $ref: '#/components/parameters/EntityIdParam'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/ViolationStatus'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Entity violations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ViolationListResponse'

  /relationships:
    get:
      tags: [Knowledge Fabric]
      summary: List relationships
      operationId: listRelationships
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: type
          in: query
          schema:
            $ref: '#/components/schemas/RelationshipType'
        - name: sourceType
          in: query
          schema:
            $ref: '#/components/schemas/EntityType'
        - name: targetType
          in: query
          schema:
            $ref: '#/components/schemas/EntityType'
        - name: isIntent
          in: query
          schema:
            type: boolean
            description: Filter by intent (documented) vs reality (observed)
      responses:
        '200':
          description: Relationship list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelationshipListResponse'
    post:
      tags: [Knowledge Fabric]
      summary: Create relationship manually
      operationId: createRelationship
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRelationshipRequest'
      responses:
        '201':
          description: Relationship created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Relationship'

  /relationships/{relationshipId}:
    delete:
      tags: [Knowledge Fabric]
      summary: Delete relationship
      operationId: deleteRelationship
      parameters:
        - name: relationshipId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Relationship deleted

  /graph:
    get:
      tags: [Knowledge Fabric]
      summary: Get graph for visualization
      operationId: getGraph
      parameters:
        - name: entityTypes
          in: query
          style: form
          explode: false
          schema:
            type: array
            items:
              $ref: '#/components/schemas/EntityType'
        - name: relationshipTypes
          in: query
          style: form
          explode: false
          schema:
            type: array
            items:
              $ref: '#/components/schemas/RelationshipType'
        - name: projectId
          in: query
          schema:
            type: string
            format: uuid
        - name: teamId
          in: query
          schema:
            type: string
            format: uuid
        - name: lens
          in: query
          schema:
            type: string
            enum: [reality, intent, drift, ownership, health]
            default: reality
        - name: limit
          in: query
          schema:
            type: integer
            default: 500
            maximum: 2000
      responses:
        '200':
          description: Graph data for rendering
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GraphResponse'

  /graph/search:
    post:
      tags: [Knowledge Fabric]
      summary: Search graph with filters
      operationId: searchGraph
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GraphSearchRequest'
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GraphResponse'

  /graph/export:
    get:
      tags: [Knowledge Fabric]
      summary: Export graph data
      operationId: exportGraph
      parameters:
        - name: format
          in: query
          required: true
          schema:
            type: string
            enum: [json, csv, graphml, gexf]
      responses:
        '200':
          description: Exported graph
          content:
            application/json:
              schema:
                type: object
            application/xml:
              schema:
                type: string
            text/csv:
              schema:
                type: string

  # ═══════════════════════════════════════════════════════════════════════════
  # GRAPHRAG
  # ═══════════════════════════════════════════════════════════════════════════
  /graphrag/query:
    post:
      tags: [GraphRAG]
      summary: Execute semantic query
      operationId: queryGraphRAG
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GraphRAGQueryRequest'
      responses:
        '200':
          description: Query result with evidence
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GraphRAGQueryResponse'

  /graphrag/query/stream:
    post:
      tags: [GraphRAG]
      summary: Execute streaming query
      operationId: streamGraphRAGQuery
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GraphRAGQueryRequest'
      responses:
        '200':
          description: Streaming response
          content:
            text/event-stream:
              schema:
                type: string

  /graphrag/index:
    post:
      tags: [GraphRAG]
      summary: Trigger indexing pipeline
      operationId: startIndexing
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IndexRequest'
      responses:
        '202':
          description: Indexing started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IndexTaskResponse'

  /graphrag/index/{taskId}:
    get:
      tags: [GraphRAG]
      summary: Get indexing task status
      operationId: getIndexStatus
      parameters:
        - name: taskId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Task status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IndexTaskStatus'

  /graphrag/index/{taskId}/cancel:
    post:
      tags: [GraphRAG]
      summary: Cancel indexing task
      operationId: cancelIndexing
      parameters:
        - name: taskId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Task cancelled

  /graphrag/communities:
    get:
      tags: [GraphRAG]
      summary: List Leiden communities
      operationId: listCommunities
      parameters:
        - name: level
          in: query
          schema:
            type: integer
            minimum: 0
            maximum: 3
            default: 0
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Community list with summaries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommunityListResponse'

  /graphrag/communities/{communityId}:
    get:
      tags: [GraphRAG]
      summary: Get community details
      operationId: getCommunity
      parameters:
        - name: communityId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Community details with members
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommunityDetail'

  /graphrag/history:
    get:
      tags: [GraphRAG]
      summary: Get query history
      operationId: getQueryHistory
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Query history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueryHistoryResponse'

  # ═══════════════════════════════════════════════════════════════════════════
  # GOVERNANCE
  # ═══════════════════════════════════════════════════════════════════════════
  /policies:
    get:
      tags: [Governance]
      summary: List policies
      operationId: listPolicies
      parameters:
        - name: category
          in: query
          schema:
            $ref: '#/components/schemas/PolicyCategory'
        - name: enabled
          in: query
          schema:
            type: boolean
        - name: enforcementMode
          in: query
          schema:
            $ref: '#/components/schemas/EnforcementMode'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Policy list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PolicyListResponse'
    post:
      tags: [Governance]
      summary: Create policy
      operationId: createPolicy
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePolicyRequest'
      responses:
        '201':
          description: Policy created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Policy'

  /policies/{policyId}:
    get:
      tags: [Governance]
      summary: Get policy details
      operationId: getPolicy
      parameters:
        - $ref: '#/components/parameters/PolicyIdParam'
      responses:
        '200':
          description: Policy details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PolicyDetail'
    patch:
      tags: [Governance]
      summary: Update policy
      operationId: updatePolicy
      parameters:
        - $ref: '#/components/parameters/PolicyIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePolicyRequest'
      responses:
        '200':
          description: Policy updated
    delete:
      tags: [Governance]
      summary: Delete policy
      operationId: deletePolicy
      parameters:
        - $ref: '#/components/parameters/PolicyIdParam'
      responses:
        '204':
          description: Policy deleted

  /policies/{policyId}/test:
    post:
      tags: [Governance]
      summary: Test policy against data
      operationId: testPolicy
      parameters:
        - $ref: '#/components/parameters/PolicyIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PolicyTestRequest'
      responses:
        '200':
          description: Test results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PolicyTestResponse'

  /policies/{policyId}/versions:
    get:
      tags: [Governance]
      summary: Get policy version history
      operationId: getPolicyVersions
      parameters:
        - $ref: '#/components/parameters/PolicyIdParam'
      responses:
        '200':
          description: Version history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PolicyVersionListResponse'

  /policies/{policyId}/versions/{version}:
    get:
      tags: [Governance]
      summary: Get specific policy version
      operationId: getPolicyVersion
      parameters:
        - $ref: '#/components/parameters/PolicyIdParam'
        - name: version
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Policy version
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Policy'

  /policies/{policyId}/rollback:
    post:
      tags: [Governance]
      summary: Rollback to previous version
      operationId: rollbackPolicy
      parameters:
        - $ref: '#/components/parameters/PolicyIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [version]
              properties:
                version:
                  type: integer
      responses:
        '200':
          description: Rollback successful

  # ═══════════════════════════════════════════════════════════════════════════
  # POLICY GENERATION (LACE Framework)
  # ═══════════════════════════════════════════════════════════════════════════
  /policies/generate:
    post:
      tags: [Policy Generation]
      summary: Generate Rego policy from natural language
      description: |
        Uses the LACE framework (LLM + Analysis + Constraint + Example) to generate
        Rego policy code from natural language descriptions. Provides validation
        and test results for the generated policy.
      operationId: generatePolicy
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PolicyGenerationRequest'
      responses:
        '200':
          description: Generated policy with validation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PolicyGenerationResponse'

  /policies/generate/refine:
    post:
      tags: [Policy Generation]
      summary: Refine generated policy with feedback
      description: Iteratively improve a generated policy based on user feedback or failed test cases
      operationId: refinePolicy
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PolicyRefinementRequest'
      responses:
        '200':
          description: Refined policy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PolicyGenerationResponse'

  /policies/generate/examples:
    get:
      tags: [Policy Generation]
      summary: Get policy generation examples
      description: Retrieve example policy descriptions and their generated Rego code for reference
      operationId: getPolicyExamples
      parameters:
        - name: category
          in: query
          schema:
            $ref: '#/components/schemas/PolicyCategory'
      responses:
        '200':
          description: Policy examples
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PolicyExample'

  /policies/validate:
    post:
      tags: [Policy Generation]
      summary: Validate Rego syntax
      operationId: validateRego
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [rego]
              properties:
                rego:
                  type: string
      responses:
        '200':
          description: Validation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegoValidationResponse'

  /policies/explain:
    post:
      tags: [Policy Generation]
      summary: Explain policy in natural language
      description: Generate a human-readable explanation of what a Rego policy does
      operationId: explainPolicy
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [rego]
              properties:
                rego:
                  type: string
      responses:
        '200':
          description: Policy explanation
          content:
            application/json:
              schema:
                type: object
                properties:
                  explanation:
                    type: string
                  summary:
                    type: string
                  rules:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        description:
                          type: string
                        effect:
                          type: string
                          enum: [allow, deny, warn]

  /governance/evaluate:
    post:
      tags: [Governance]
      summary: Evaluate policies against input
      operationId: evaluatePolicies
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EvaluationRequest'
      responses:
        '200':
          description: Evaluation results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvaluationResponse'

  /governance/evaluate/batch:
    post:
      tags: [Governance]
      summary: Batch evaluate multiple inputs
      operationId: batchEvaluatePolicies
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [inputs]
              properties:
                inputs:
                  type: array
                  items:
                    type: object
                policyIds:
                  type: array
                  items:
                    type: string
                    format: uuid
      responses:
        '200':
          description: Batch evaluation results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchEvaluationResponse'

  # ═══════════════════════════════════════════════════════════════════════════
  # IMPACT ANALYSIS & SIMULATION
  # ═══════════════════════════════════════════════════════════════════════════
  /governance/impact:
    post:
      tags: [Impact Analysis]
      summary: Calculate blast radius for entity changes
      description: |
        Analyzes the downstream impact of changes to specified entities.
        Returns affected entities, triggered policies, and risk assessment.
      operationId: calculateImpact
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ImpactAnalysisRequest'
      responses:
        '200':
          description: Impact analysis results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImpactAnalysisResponse'

  /governance/simulate-change:
    post:
      tags: [Impact Analysis]
      summary: Simulate architectural changes
      description: |
        Simulates proposed changes against the knowledge graph and evaluates
        policy compliance of the resulting state without persisting changes.
      operationId: simulateChange
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangeSimulationRequest'
      responses:
        '200':
          description: Simulation results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChangeSimulationResponse'

  /governance/what-if:
    post:
      tags: [Impact Analysis]
      summary: What-if scenario analysis
      description: Run predefined scenario types (removal, migration, team change) against current state
      operationId: whatIfAnalysis
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WhatIfRequest'
      responses:
        '200':
          description: Scenario analysis results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WhatIfResponse'

  /governance/dependency-check:
    post:
      tags: [Impact Analysis]
      summary: Check if entity can be safely deleted
      operationId: checkDependencies
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [entityId]
              properties:
                entityId:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Dependency check result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DependencyCheckResponse'

  # ═══════════════════════════════════════════════════════════════════════════
  # WEBHOOK RECEIVERS
  # ═══════════════════════════════════════════════════════════════════════════
  /webhooks/github:
    post:
      tags: [Webhooks]
      summary: GitHub webhook receiver
      description: Receives push, pull request, and other events from GitHub
      operationId: receiveGitHubWebhook
      security:
        - WebhookSignature: []
      parameters:
        - name: X-GitHub-Event
          in: header
          required: true
          schema:
            type: string
        - name: X-GitHub-Delivery
          in: header
          schema:
            type: string
        - name: X-Hub-Signature-256
          in: header
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Webhook received
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookResponse'
        '401':
          description: Invalid signature

  /webhooks/gitlab:
    post:
      tags: [Webhooks]
      summary: GitLab webhook receiver
      description: Receives push, merge request, and other events from GitLab
      operationId: receiveGitLabWebhook
      security:
        - WebhookToken: []
      parameters:
        - name: X-Gitlab-Event
          in: header
          required: true
          schema:
            type: string
        - name: X-Gitlab-Token
          in: header
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Webhook received
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookResponse'

  /webhooks/jira:
    post:
      tags: [Webhooks]
      summary: Jira webhook receiver
      description: Receives issue created, updated, and other events from Jira
      operationId: receiveJiraWebhook
      security:
        - WebhookSignature: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Webhook received
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookResponse'

  /webhooks/confluence:
    post:
      tags: [Webhooks]
      summary: Confluence webhook receiver
      description: Receives page created, updated events from Confluence
      operationId: receiveConfluenceWebhook
      security:
        - WebhookSignature: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Webhook received
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookResponse'

  /webhooks/slack:
    post:
      tags: [Webhooks]
      summary: Slack events receiver
      description: Receives Slack events and slash commands
      operationId: receiveSlackWebhook
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
          application/x-www-form-urlencoded:
            schema:
              type: object
      responses:
        '200':
          description: Webhook received
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookResponse'

  /webhooks/custom/{webhookId}:
    post:
      tags: [Webhooks]
      summary: Custom webhook receiver
      description: Generic webhook endpoint for custom integrations
      operationId: receiveCustomWebhook
      parameters:
        - name: webhookId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Webhook received
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookResponse'

  /webhooks:
    get:
      tags: [Webhooks]
      summary: List webhook configurations
      operationId: listWebhookConfigs
      responses:
        '200':
          description: Webhook configurations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookConfigListResponse'
    post:
      tags: [Webhooks]
      summary: Create custom webhook endpoint
      operationId: createWebhookConfig
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWebhookRequest'
      responses:
        '201':
          description: Webhook created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookConfig'

  /webhooks/{webhookId}:
    get:
      tags: [Webhooks]
      summary: Get webhook configuration
      operationId: getWebhookConfig
      parameters:
        - name: webhookId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Webhook configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookConfig'
    patch:
      tags: [Webhooks]
      summary: Update webhook configuration
      operationId: updateWebhookConfig
      parameters:
        - name: webhookId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWebhookRequest'
      responses:
        '200':
          description: Webhook updated
    delete:
      tags: [Webhooks]
      summary: Delete webhook configuration
      operationId: deleteWebhookConfig
      parameters:
        - name: webhookId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Webhook deleted

  /webhooks/{webhookId}/secret:
    post:
      tags: [Webhooks]
      summary: Rotate webhook secret
      operationId: rotateWebhookSecret
      parameters:
        - name: webhookId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: New secret generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  secret:
                    type: string

  /webhooks/{webhookId}/deliveries:
    get:
      tags: [Webhooks]
      summary: Get webhook delivery history
      operationId: getWebhookDeliveries
      parameters:
        - name: webhookId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            type: string
            enum: [success, failed, pending]
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Delivery history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookDeliveryListResponse'

  /webhooks/{webhookId}/deliveries/{deliveryId}/redeliver:
    post:
      tags: [Webhooks]
      summary: Redeliver failed webhook
      operationId: redeliverWebhook
      parameters:
        - name: webhookId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: deliveryId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '202':
          description: Redelivery queued

  /violations:
    get:
      tags: [Governance]
      summary: List violations
      operationId: listViolations
      parameters:
        - name: policyId
          in: query
          schema:
            type: string
            format: uuid
        - name: severity
          in: query
          schema:
            $ref: '#/components/schemas/Severity'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/ViolationStatus'
        - name: entityId
          in: query
          schema:
            type: string
            format: uuid
        - name: teamId
          in: query
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Violation list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ViolationListResponse'

  /violations/{violationId}:
    get:
      tags: [Governance]
      summary: Get violation details
      operationId: getViolation
      parameters:
        - $ref: '#/components/parameters/ViolationIdParam'
      responses:
        '200':
          description: Violation details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ViolationDetail'
    patch:
      tags: [Governance]
      summary: Update violation status
      operationId: updateViolationStatus
      parameters:
        - $ref: '#/components/parameters/ViolationIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  $ref: '#/components/schemas/ViolationStatus'
                reason:
                  type: string
      responses:
        '200':
          description: Violation updated

  /violations/{violationId}/suppress:
    post:
      tags: [Governance]
      summary: Suppress violation
      operationId: suppressViolation
      parameters:
        - $ref: '#/components/parameters/ViolationIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [reason]
              properties:
                reason:
                  type: string
                expiresAt:
                  type: string
                  format: date-time
      responses:
        '200':
          description: Violation suppressed

  /violations/summary:
    get:
      tags: [Governance]
      summary: Get violations summary
      description: Returns aggregated violation counts by severity, status, and category with trend data
      operationId: getViolationsSummary
      parameters:
        - name: projectId
          in: query
          schema:
            type: string
            format: uuid
        - name: teamId
          in: query
          schema:
            type: string
            format: uuid
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Violations summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ViolationsSummary'

  # ═══════════════════════════════════════════════════════════════════════════
  # MARKETPLACE
  # ═══════════════════════════════════════════════════════════════════════════
  /marketplace/plugins:
    get:
      tags: [Marketplace]
      summary: Browse available plugins
      operationId: browsePlugins
      parameters:
        - name: category
          in: query
          schema:
            $ref: '#/components/schemas/PluginCategory'
        - name: search
          in: query
          schema:
            type: string
        - name: sort
          in: query
          schema:
            type: string
            enum: [popular, recent, rating, name]
            default: popular
        - name: verified
          in: query
          schema:
            type: boolean
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Plugin catalog
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PluginCatalogResponse'

  /marketplace/plugins/{pluginId}:
    get:
      tags: [Marketplace]
      summary: Get plugin details
      operationId: getPluginDetails
      parameters:
        - $ref: '#/components/parameters/PluginIdParam'
      responses:
        '200':
          description: Plugin details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PluginDetail'

  /marketplace/plugins/{pluginId}/versions:
    get:
      tags: [Marketplace]
      summary: List plugin versions
      operationId: listPluginVersions
      parameters:
        - $ref: '#/components/parameters/PluginIdParam'
      responses:
        '200':
          description: Version list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PluginVersionListResponse'

  /marketplace/plugins/{pluginId}/reviews:
    get:
      tags: [Marketplace]
      summary: Get plugin reviews
      operationId: getPluginReviews
      parameters:
        - $ref: '#/components/parameters/PluginIdParam'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Reviews
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PluginReviewListResponse'
    post:
      tags: [Marketplace]
      summary: Submit plugin review
      operationId: submitPluginReview
      parameters:
        - $ref: '#/components/parameters/PluginIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePluginReviewRequest'
      responses:
        '201':
          description: Review submitted

  /marketplace/categories:
    get:
      tags: [Marketplace]
      summary: List plugin categories
      operationId: listPluginCategories
      responses:
        '200':
          description: Category list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PluginCategoryInfo'

  /marketplace/featured:
    get:
      tags: [Marketplace]
      summary: Get featured plugins
      operationId: getFeaturedPlugins
      responses:
        '200':
          description: Featured plugins
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Plugin'

  /marketplace/installed:
    get:
      tags: [Marketplace]
      summary: List installed plugins
      operationId: listInstalledPlugins
      responses:
        '200':
          description: Installed plugins
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstalledPluginListResponse'

  /marketplace/install:
    post:
      tags: [Marketplace]
      summary: Install plugin
      operationId: installPlugin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [pluginId]
              properties:
                pluginId:
                  type: string
                version:
                  type: string
                  description: Specific version or 'latest'
      responses:
        '202':
          description: Installation started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PluginInstallationStatus'

  /marketplace/installed/{installationId}:
    get:
      tags: [Marketplace]
      summary: Get installation status
      operationId: getInstallationStatus
      parameters:
        - name: installationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Installation status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstalledPlugin'
    delete:
      tags: [Marketplace]
      summary: Uninstall plugin
      operationId: uninstallPlugin
      parameters:
        - name: installationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Plugin uninstalled

  /marketplace/installed/{installationId}/update:
    post:
      tags: [Marketplace]
      summary: Update plugin to new version
      operationId: updatePlugin
      parameters:
        - name: installationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                version:
                  type: string
      responses:
        '202':
          description: Update started

  /marketplace/installed/{installationId}/enable:
    post:
      tags: [Marketplace]
      summary: Enable plugin
      operationId: enablePlugin
      parameters:
        - name: installationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Plugin enabled

  /marketplace/installed/{installationId}/disable:
    post:
      tags: [Marketplace]
      summary: Disable plugin
      operationId: disablePlugin
      parameters:
        - name: installationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Plugin disabled

  /marketplace/custom:
    post:
      tags: [Marketplace]
      summary: Upload custom plugin (Enterprise)
      operationId: uploadCustomPlugin
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [manifest, package]
              properties:
                manifest:
                  type: string
                  format: binary
                  description: plugin.yaml manifest
                package:
                  type: string
                  format: binary
                  description: Plugin package (.tar.gz)
      responses:
        '201':
          description: Custom plugin uploaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Plugin'

  # ═══════════════════════════════════════════════════════════════════════════
  # CONNECTORS (Plugin Instances / Connections)
  # ═══════════════════════════════════════════════════════════════════════════
  /connectors:
    get:
      tags: [Connectors]
      summary: List configured connections
      operationId: listConnections
      parameters:
        - name: pluginId
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/ConnectionStatus'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Connection list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConnectionListResponse'
    post:
      tags: [Connectors]
      summary: Create connection
      operationId: createConnection
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateConnectionRequest'
      responses:
        '201':
          description: Connection created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Connection'

  /connectors/{connectionId}:
    get:
      tags: [Connectors]
      summary: Get connection details
      operationId: getConnection
      parameters:
        - $ref: '#/components/parameters/ConnectionIdParam'
      responses:
        '200':
          description: Connection details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConnectionDetail'
    patch:
      tags: [Connectors]
      summary: Update connection
      operationId: updateConnection
      parameters:
        - $ref: '#/components/parameters/ConnectionIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateConnectionRequest'
      responses:
        '200':
          description: Connection updated
    delete:
      tags: [Connectors]
      summary: Delete connection
      operationId: deleteConnection
      parameters:
        - $ref: '#/components/parameters/ConnectionIdParam'
      responses:
        '204':
          description: Connection deleted

  /connectors/{connectionId}/test:
    post:
      tags: [Connectors]
      summary: Test connection
      operationId: testConnection
      parameters:
        - $ref: '#/components/parameters/ConnectionIdParam'
      responses:
        '200':
          description: Test result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConnectionTestResult'

  /connectors/{connectionId}/sync:
    post:
      tags: [Connectors]
      summary: Trigger manual sync
      operationId: triggerSync
      parameters:
        - $ref: '#/components/parameters/ConnectionIdParam'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                fullSync:
                  type: boolean
                  default: false
                  description: Force full re-sync vs incremental
      responses:
        '202':
          description: Sync started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SyncTask'

  /connectors/{connectionId}/sync/{taskId}:
    get:
      tags: [Connectors]
      summary: Get sync task status
      operationId: getSyncStatus
      parameters:
        - $ref: '#/components/parameters/ConnectionIdParam'
        - name: taskId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Sync status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SyncTaskStatus'

  /connectors/{connectionId}/sync/{taskId}/cancel:
    post:
      tags: [Connectors]
      summary: Cancel sync task
      operationId: cancelSync
      parameters:
        - $ref: '#/components/parameters/ConnectionIdParam'
        - name: taskId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Sync cancelled

  /connectors/{connectionId}/logs:
    get:
      tags: [Connectors]
      summary: Get connection logs
      operationId: getConnectionLogs
      parameters:
        - $ref: '#/components/parameters/ConnectionIdParam'
        - name: level
          in: query
          schema:
            type: string
            enum: [debug, info, warn, error]
        - name: since
          in: query
          schema:
            type: string
            format: date-time
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Connection logs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConnectionLogResponse'

  /connectors/{connectionId}/oauth/authorize:
    get:
      tags: [Connectors]
      summary: Get OAuth authorization URL
      operationId: getOAuthUrl
      parameters:
        - $ref: '#/components/parameters/ConnectionIdParam'
      responses:
        '200':
          description: Authorization URL
          content:
            application/json:
              schema:
                type: object
                properties:
                  authorizationUrl:
                    type: string
                    format: uri
                  state:
                    type: string

  /connectors/{connectionId}/oauth/callback:
    post:
      tags: [Connectors]
      summary: Handle OAuth callback
      operationId: handleOAuthCallback
      parameters:
        - $ref: '#/components/parameters/ConnectionIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [code, state]
              properties:
                code:
                  type: string
                state:
                  type: string
      responses:
        '200':
          description: OAuth completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Connection'

  # ═══════════════════════════════════════════════════════════════════════════
  # QUALITY METRICS
  # ═══════════════════════════════════════════════════════════════════════════
  /metrics/health:
    get:
      tags: [Quality Metrics]
      summary: Get overall health score
      operationId: getHealthScore
      parameters:
        - name: projectId
          in: query
          schema:
            type: string
            format: uuid
        - name: teamId
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Health score with dimensions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthScore'

  /metrics/health/history:
    get:
      tags: [Quality Metrics]
      summary: Get health score history
      operationId: getHealthHistory
      parameters:
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
        - name: granularity
          in: query
          schema:
            type: string
            enum: [daily, weekly, monthly]
            default: daily
      responses:
        '200':
          description: Health history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthHistoryResponse'

  /metrics/drift:
    get:
      tags: [Quality Metrics]
      summary: Get drift metrics
      operationId: getDriftMetrics
      parameters:
        - name: projectId
          in: query
          schema:
            type: string
            format: uuid
        - name: teamId
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Drift metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DriftMetrics'

  /metrics/compliance:
    get:
      tags: [Quality Metrics]
      summary: Get compliance metrics
      operationId: getComplianceMetrics
      parameters:
        - name: projectId
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Compliance metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComplianceMetrics'

  /metrics/dora:
    get:
      tags: [Quality Metrics]
      summary: Get DORA metrics
      operationId: getDORAMetrics
      parameters:
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
        - name: teamId
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: DORA metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DORAMetrics'

  /metrics/knowledge-graph:
    get:
      tags: [Quality Metrics]
      summary: Get knowledge graph metrics
      operationId: getKnowledgeGraphMetrics
      responses:
        '200':
          description: Knowledge graph metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/KnowledgeGraphMetrics'

  /metrics/documentation:
    get:
      tags: [Quality Metrics]
      summary: Get documentation metrics
      operationId: getDocumentationMetrics
      parameters:
        - name: projectId
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Documentation metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentationMetrics'

  /metrics/technical-debt:
    get:
      tags: [Quality Metrics]
      summary: Get technical debt metrics
      operationId: getTechnicalDebtMetrics
      parameters:
        - name: projectId
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Technical debt metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TechnicalDebtMetrics'

  # ═══════════════════════════════════════════════════════════════════════════
  # MAINTENANCE
  # ═══════════════════════════════════════════════════════════════════════════
  /documents/{documentId}/staleness:
    get:
      tags: [Maintenance]
      summary: Get document staleness score
      operationId: getDocumentStaleness
      parameters:
        - name: documentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Staleness report
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StalenessReport'

  /maintenance/staleness:
    get:
      tags: [Maintenance]
      summary: List stale documents
      operationId: listStaleDocuments
      parameters:
        - name: minScore
          in: query
          schema:
            type: number
            minimum: 0
            maximum: 1
            default: 0.5
        - name: projectId
          in: query
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Stale documents
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StaleDocumentListResponse'
    post:
      tags: [Maintenance]
      summary: Trigger staleness scan
      operationId: triggerStalenessScan
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  type: string
                  format: uuid
                force:
                  type: boolean
                  default: false
      responses:
        '202':
          description: Scan started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceTaskResponse'

  /maintenance/duplicates:
    get:
      tags: [Maintenance]
      summary: Get duplicate detection results
      operationId: getDuplicates
      parameters:
        - name: projectId
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Duplicate report
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DuplicateReport'
    post:
      tags: [Maintenance]
      summary: Trigger duplicate detection
      operationId: triggerDuplicateDetection
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                projectId:
                  type: string
                  format: uuid
                threshold:
                  type: number
                  default: 0.85
      responses:
        '202':
          description: Detection started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceTaskResponse'

  /maintenance/link-validation:
    get:
      tags: [Maintenance]
      summary: Get link validation results
      operationId: getLinkValidation
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [broken, redirected, valid]
      responses:
        '200':
          description: Link validation report
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LinkValidationReport'
    post:
      tags: [Maintenance]
      summary: Trigger link validation
      operationId: triggerLinkValidation
      responses:
        '202':
          description: Validation started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceTaskResponse'

  /maintenance/reviews:
    get:
      tags: [Maintenance]
      summary: Get review queue
      operationId: getReviewQueue
      parameters:
        - name: itemType
          in: query
          schema:
            type: string
            enum: [staleness, duplicate, enrichment, merge]
        - name: assigneeId
          in: query
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Review queue
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReviewListResponse'

  /maintenance/reviews/{reviewId}:
    get:
      tags: [Maintenance]
      summary: Get review item details
      operationId: getReviewItem
      parameters:
        - name: reviewId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Review item
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReviewItem'

  /maintenance/reviews/{reviewId}/decide:
    post:
      tags: [Maintenance]
      summary: Submit review decision
      operationId: submitReviewDecision
      parameters:
        - name: reviewId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReviewDecisionRequest'
      responses:
        '200':
          description: Decision recorded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReviewItem'

  /maintenance/reviews/{reviewId}/assign:
    post:
      tags: [Maintenance]
      summary: Assign review item
      operationId: assignReviewItem
      parameters:
        - name: reviewId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [assigneeId]
              properties:
                assigneeId:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Item assigned

  # ═══════════════════════════════════════════════════════════════════════════
  # EXPORT
  # ═══════════════════════════════════════════════════════════════════════════
  /export/graph:
    post:
      tags: [Export]
      summary: Export knowledge graph
      operationId: exportGraph
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GraphExportRequest'
      responses:
        '202':
          description: Export started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportTaskResponse'

  /export/graph/{taskId}:
    get:
      tags: [Export]
      summary: Get graph export status/download
      operationId: getGraphExport
      parameters:
        - name: taskId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Export ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportStatus'
            application/octet-stream:
              schema:
                type: string
                format: binary

  /export/report:
    post:
      tags: [Export]
      summary: Generate report
      operationId: generateReport
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReportRequest'
      responses:
        '202':
          description: Report generation started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportTaskResponse'

  /export/report/{taskId}:
    get:
      tags: [Export]
      summary: Get report status/download
      operationId: getReport
      parameters:
        - name: taskId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Report ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportStatus'
            application/pdf:
              schema:
                type: string
                format: binary

  /export/compliance:
    post:
      tags: [Export]
      summary: Generate compliance report
      operationId: generateComplianceReport
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ComplianceReportRequest'
      responses:
        '202':
          description: Report generation started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportTaskResponse'

  /export/metrics:
    post:
      tags: [Export]
      summary: Export metrics data
      operationId: exportMetrics
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MetricsExportRequest'
      responses:
        '200':
          description: Metrics export
          content:
            text/csv:
              schema:
                type: string
            application/json:
              schema:
                type: object

  /export/diagram:
    post:
      tags: [Export]
      summary: Export architecture diagram (SVG)
      operationId: exportDiagram
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DiagramExportRequest'
      responses:
        '200':
          description: SVG diagram
          content:
            image/svg+xml:
              schema:
                type: string
            application/json:
              schema:
                $ref: '#/components/schemas/ExportTaskResponse'

  # ═══════════════════════════════════════════════════════════════════════════
  # SETTINGS
  # ═══════════════════════════════════════════════════════════════════════════
  /settings:
    get:
      tags: [Settings]
      summary: Get all settings
      operationId: getSettings
      responses:
        '200':
          description: Settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Settings'
    patch:
      tags: [Settings]
      summary: Update settings
      operationId: updateSettings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSettingsRequest'
      responses:
        '200':
          description: Settings updated

  /settings/llm:
    get:
      tags: [Settings]
      summary: Get LLM configuration
      operationId: getLLMSettings
      responses:
        '200':
          description: LLM settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LLMSettings'
    put:
      tags: [Settings]
      summary: Update LLM configuration
      operationId: updateLLMSettings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateLLMSettingsRequest'
      responses:
        '200':
          description: LLM settings updated

  /settings/llm/test:
    post:
      tags: [Settings]
      summary: Test LLM connection
      operationId: testLLMConnection
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LLMTestRequest'
      responses:
        '200':
          description: Test result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LLMTestResult'

  /settings/llm/providers:
    get:
      tags: [Settings]
      summary: List available LLM providers
      operationId: listLLMProviders
      responses:
        '200':
          description: Provider list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LLMProvider'

  /settings/notifications:
    get:
      tags: [Settings]
      summary: Get notification settings
      operationId: getNotificationSettings
      responses:
        '200':
          description: Notification settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationSettings'
    put:
      tags: [Settings]
      summary: Update notification settings
      operationId: updateNotificationSettings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NotificationSettings'
      responses:
        '200':
          description: Settings updated

  /settings/retention:
    get:
      tags: [Settings]
      summary: Get data retention settings
      operationId: getRetentionSettings
      responses:
        '200':
          description: Retention settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RetentionSettings'
    put:
      tags: [Settings]
      summary: Update data retention settings
      operationId: updateRetentionSettings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RetentionSettings'
      responses:
        '200':
          description: Settings updated

  # ═══════════════════════════════════════════════════════════════════════════
  # AUDIT
  # ═══════════════════════════════════════════════════════════════════════════
  /audit/logs:
    get:
      tags: [Audit]
      summary: Query audit logs
      operationId: queryAuditLogs
      parameters:
        - name: userId
          in: query
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          schema:
            type: string
            enum: [create, read, update, delete, login, logout, export, evaluate]
        - name: resourceType
          in: query
          schema:
            type: string
        - name: resourceId
          in: query
          schema:
            type: string
            format: uuid
        - name: startTime
          in: query
          schema:
            type: string
            format: date-time
        - name: endTime
          in: query
          schema:
            type: string
            format: date-time
        - name: outcome
          in: query
          schema:
            type: string
            enum: [success, failure, denied]
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Audit logs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogListResponse'

  /audit/logs/{logId}:
    get:
      tags: [Audit]
      summary: Get audit log entry details
      operationId: getAuditLogEntry
      parameters:
        - name: logId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Audit log entry
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogEntry'

  /audit/logs/export:
    post:
      tags: [Audit]
      summary: Export audit logs
      operationId: exportAuditLogs
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                startTime:
                  type: string
                  format: date-time
                endTime:
                  type: string
                  format: date-time
                format:
                  type: string
                  enum: [json, csv]
                  default: json
      responses:
        '202':
          description: Export started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportTaskResponse'

  /audit/summary:
    get:
      tags: [Audit]
      summary: Get audit summary
      operationId: getAuditSummary
      parameters:
        - name: startTime
          in: query
          schema:
            type: string
            format: date-time
        - name: endTime
          in: query
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Audit summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditSummary'

  # ═══════════════════════════════════════════════════════════════════════════
  # ADMIN
  # ═══════════════════════════════════════════════════════════════════════════
  /admin/system/status:
    get:
      tags: [Admin]
      summary: Get system status
      operationId: getSystemStatus
      responses:
        '200':
          description: System status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemStatus'

  /admin/system/health:
    get:
      tags: [Admin]
      summary: Health check endpoint
      operationId: healthCheck
      security: []
      responses:
        '200':
          description: System healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [healthy, degraded, unhealthy]
                  components:
                    type: object

  /admin/databases/neo4j:
    get:
      tags: [Admin]
      summary: Get Neo4j cluster status
      operationId: getNeo4jStatus
      responses:
        '200':
          description: Neo4j status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseStatus'

  /admin/databases/qdrant:
    get:
      tags: [Admin]
      summary: Get Qdrant status
      operationId: getQdrantStatus
      responses:
        '200':
          description: Qdrant status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VectorStoreStatus'

  /admin/databases/qdrant/collections:
    get:
      tags: [Admin]
      summary: List Qdrant collections
      operationId: listQdrantCollections
      responses:
        '200':
          description: Collection list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/VectorCollection'

  /admin/databases/qdrant/collections/{collectionName}:
    get:
      tags: [Admin]
      summary: Get collection details
      operationId: getQdrantCollection
      parameters:
        - name: collectionName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Collection details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VectorCollectionDetail'
    delete:
      tags: [Admin]
      summary: Delete collection (DANGER)
      operationId: deleteQdrantCollection
      parameters:
        - name: collectionName
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Collection deleted

  /admin/databases/qdrant/collections/{collectionName}/optimize:
    post:
      tags: [Admin]
      summary: Optimize collection
      operationId: optimizeQdrantCollection
      parameters:
        - name: collectionName
          in: path
          required: true
          schema:
            type: string
      responses:
        '202':
          description: Optimization started

  /admin/ingestion/queue:
    get:
      tags: [Admin]
      summary: Inspect ingestion queue
      operationId: inspectIngestionQueue
      responses:
        '200':
          description: Queue status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngestionQueueStatus'

  /admin/ingestion/queue/pause:
    post:
      tags: [Admin]
      summary: Pause ingestion queue
      operationId: pauseIngestionQueue
      responses:
        '200':
          description: Queue paused

  /admin/ingestion/queue/resume:
    post:
      tags: [Admin]
      summary: Resume ingestion queue
      operationId: resumeIngestionQueue
      responses:
        '200':
          description: Queue resumed

  /admin/ingestion/queue/clear:
    post:
      tags: [Admin]
      summary: Clear ingestion queue (DANGER)
      operationId: clearIngestionQueue
      responses:
        '204':
          description: Queue cleared

  /admin/backup:
    post:
      tags: [Admin]
      summary: Trigger manual backup
      operationId: triggerBackup
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                includeGraph:
                  type: boolean
                  default: true
                includeVectors:
                  type: boolean
                  default: true
                includeAudit:
                  type: boolean
                  default: true
      responses:
        '202':
          description: Backup started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackupTask'

  /admin/backup/status:
    get:
      tags: [Admin]
      summary: Get backup status
      operationId: getBackupStatus
      responses:
        '200':
          description: Backup status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BackupStatus'

  /admin/backup/history:
    get:
      tags: [Admin]
      summary: Get backup history
      operationId: getBackupHistory
      parameters:
        - $ref: '#/components/parameters/LimitParam'
      responses:
        '200':
          description: Backup history
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BackupRecord'

  /admin/cache/clear:
    post:
      tags: [Admin]
      summary: Clear system caches
      operationId: clearCaches
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                caches:
                  type: array
                  items:
                    type: string
                    enum: [graphrag, embeddings, policies, sessions]
      responses:
        '204':
          description: Caches cleared

  /admin/jobs:
    get:
      tags: [Admin]
      summary: List background jobs
      operationId: listBackgroundJobs
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, running, completed, failed]
        - name: type
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Job list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobListResponse'

  /admin/jobs/{jobId}:
    get:
      tags: [Admin]
      summary: Get job details
      operationId: getJob
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Job details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Job'

  /admin/jobs/{jobId}/cancel:
    post:
      tags: [Admin]
      summary: Cancel job
      operationId: cancelJob
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Job cancelled

  /admin/jobs/{jobId}/retry:
    post:
      tags: [Admin]
      summary: Retry failed job
      operationId: retryJob
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '202':
          description: Job requeued

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
    WebhookSignature:
      type: apiKey
      in: header
      name: X-Webhook-Signature
    WebhookToken:
      type: apiKey
      in: header
      name: X-Webhook-Token

  parameters:
    PageParam:
      name: page
      in: query
      schema:
        type: integer
        minimum: 1
        default: 1
    LimitParam:
      name: limit
      in: query
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
    OrgIdParam:
      name: orgId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    TeamIdParam:
      name: teamId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    ProjectIdParam:
      name: projectId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    UserIdParam:
      name: userId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    EntityIdParam:
      name: entityId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    PolicyIdParam:
      name: policyId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    ViolationIdParam:
      name: violationId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    PluginIdParam:
      name: pluginId
      in: path
      required: true
      schema:
        type: string
    ConnectionIdParam:
      name: connectionId
      in: path
      required: true
      schema:
        type: string
        format: uuid

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    RateLimited:
      description: Rate limited
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
      headers:
        Retry-After:
          schema:
            type: integer
        X-RateLimit-Limit:
          schema:
            type: integer
        X-RateLimit-Remaining:
          schema:
            type: integer

  schemas:
    # ===== Common =====
    Error:
      type: object
      required: [code, message]
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: object
        requestId:
          type: string

    PaginationMeta:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        totalPages:
          type: integer

    # ===== Auth =====
    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
        mfaCode:
          type: string

    AuthResponse:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
        expiresIn:
          type: integer
        tokenType:
          type: string
          default: Bearer
        user:
          $ref: '#/components/schemas/User'
        requiresMFA:
          type: boolean

    MFASetupResponse:
      type: object
      properties:
        secret:
          type: string
        qrCodeUri:
          type: string
        backupCodes:
          type: array
          items:
            type: string

    # ===== Organizations =====
    Organization:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        slug:
          type: string
        logoUrl:
          type: string
        plan:
          type: string
          enum: [free, team, enterprise]
        status:
          type: string
          enum: [active, suspended, trial]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    OrganizationDetail:
      allOf:
        - $ref: '#/components/schemas/Organization'
        - type: object
          properties:
            memberCount:
              type: integer
            teamCount:
              type: integer
            projectCount:
              type: integer
            settings:
              type: object
            ssoEnabled:
              type: boolean

    OrganizationListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Organization'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    CreateOrganizationRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 100
        slug:
          type: string
          pattern: '^[a-z0-9-]+$'

    UpdateOrganizationRequest:
      type: object
      properties:
        name:
          type: string
        logoUrl:
          type: string
        settings:
          type: object

    OrgRole:
      type: string
      enum: [owner, admin, member, billing]

    OrgMember:
      type: object
      properties:
        userId:
          type: string
          format: uuid
        email:
          type: string
        name:
          type: string
        role:
          $ref: '#/components/schemas/OrgRole'
        status:
          type: string
          enum: [active, pending, suspended]
        joinedAt:
          type: string
          format: date-time

    OrgMemberDetail:
      allOf:
        - $ref: '#/components/schemas/OrgMember'
        - type: object
          properties:
            teams:
              type: array
              items:
                $ref: '#/components/schemas/TeamMembership'
            lastActiveAt:
              type: string
              format: date-time

    OrgMemberListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/OrgMember'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    InviteMemberRequest:
      type: object
      required: [email, role]
      properties:
        email:
          type: string
          format: email
        role:
          $ref: '#/components/schemas/OrgRole'
        teamIds:
          type: array
          items:
            type: string
            format: uuid
        message:
          type: string

    InvitationListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              email:
                type: string
              role:
                $ref: '#/components/schemas/OrgRole'
              status:
                type: string
                enum: [pending, accepted, expired, cancelled]
              invitedBy:
                type: string
              invitedAt:
                type: string
                format: date-time
              expiresAt:
                type: string
                format: date-time

    SSOConfig:
      type: object
      properties:
        enabled:
          type: boolean
        provider:
          type: string
          enum: [okta, azure-ad, google, saml-generic]
        oidc:
          type: object
          properties:
            issuer:
              type: string
            clientId:
              type: string
            scopes:
              type: array
              items:
                type: string
        saml:
          type: object
          properties:
            idpEntityId:
              type: string
            idpSsoUrl:
              type: string
            idpCertificate:
              type: string
        roleMapping:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/OrgRole'
        enforced:
          type: boolean
        allowedDomains:
          type: array
          items:
            type: string

    BillingInfo:
      type: object
      properties:
        plan:
          type: string
        status:
          type: string
          enum: [active, past_due, cancelled, trialing]
        currentPeriodStart:
          type: string
          format: date-time
        currentPeriodEnd:
          type: string
          format: date-time
        usage:
          type: object
          properties:
            users:
              type: object
              properties:
                used:
                  type: integer
                limit:
                  type: integer
            storage:
              type: object
              properties:
                usedGb:
                  type: number
                limitGb:
                  type: number
            apiCalls:
              type: object
              properties:
                used:
                  type: integer
                limit:
                  type: integer

    UpdateBillingRequest:
      type: object
      properties:
        plan:
          type: string
        paymentMethodId:
          type: string

    UsageStats:
      type: object
      properties:
        period:
          type: object
          properties:
            start:
              type: string
              format: date-time
            end:
              type: string
              format: date-time
        metrics:
          type: object
          properties:
            activeUsers:
              type: integer
            entitiesCreated:
              type: integer
            policiesEvaluated:
              type: integer
            graphRAGQueries:
              type: integer
            storageUsedGb:
              type: number
        breakdown:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              values:
                type: object

    QuotaInfo:
      type: object
      properties:
        users:
          type: object
          properties:
            used:
              type: integer
            limit:
              type: integer
        teams:
          type: object
          properties:
            used:
              type: integer
            limit:
              type: integer
        projects:
          type: object
          properties:
            used:
              type: integer
            limit:
              type: integer
        connections:
          type: object
          properties:
            used:
              type: integer
            limit:
              type: integer
        storageGb:
          type: object
          properties:
            used:
              type: number
            limit:
              type: number

    # ===== Teams =====
    Team:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        slug:
          type: string
        avatarUrl:
          type: string
        memberCount:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    TeamDetail:
      allOf:
        - $ref: '#/components/schemas/Team'
        - type: object
          properties:
            ownedEntities:
              type: integer
            activeViolations:
              type: integer
            settings:
              type: object
              properties:
                slackChannel:
                  type: string
                oncallRotation:
                  type: string

    TeamListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Team'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    CreateTeamRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string
        slug:
          type: string

    UpdateTeamRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        avatarUrl:
          type: string
        settings:
          type: object

    TeamRole:
      type: string
      enum: [lead, member, viewer]

    TeamMember:
      type: object
      properties:
        userId:
          type: string
          format: uuid
        email:
          type: string
        name:
          type: string
        avatarUrl:
          type: string
        role:
          $ref: '#/components/schemas/TeamRole'
        joinedAt:
          type: string
          format: date-time

    TeamMemberListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/TeamMember'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    TeamMembership:
      type: object
      properties:
        teamId:
          type: string
          format: uuid
        teamName:
          type: string
        role:
          $ref: '#/components/schemas/TeamRole'

    TeamMetrics:
      type: object
      properties:
        teamId:
          type: string
          format: uuid
        ownedEntities:
          type: integer
        activeViolations:
          type: integer
        violationsBySeverity:
          type: object
          properties:
            critical:
              type: integer
            high:
              type: integer
            medium:
              type: integer
            low:
              type: integer
        documentationCoverage:
          type: number
        avgStaleness:
          type: number
        deploymentFrequency:
          type: number
        healthScore:
          type: number

    # ===== Projects =====
    Project:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        slug:
          type: string
        status:
          type: string
          enum: [active, archived, draft]
        teamId:
          type: string
          format: uuid
        teamName:
          type: string
        entityCount:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ProjectDetail:
      allOf:
        - $ref: '#/components/schemas/Project'
        - type: object
          properties:
            connections:
              type: array
              items:
                type: object
                properties:
                  connectionId:
                    type: string
                    format: uuid
                  name:
                    type: string
                  status:
                    $ref: '#/components/schemas/ConnectionStatus'
            healthScore:
              type: number
            violationCount:
              type: integer
            settings:
              type: object

    ProjectListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Project'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    CreateProjectRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string
        teamId:
          type: string
          format: uuid
        connectionIds:
          type: array
          items:
            type: string
            format: uuid

    UpdateProjectRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [active, draft]
        teamId:
          type: string
          format: uuid

    # ===== Users =====
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
        name:
          type: string
        avatarUrl:
          type: string
        role:
          $ref: '#/components/schemas/UserRole'
        status:
          type: string
          enum: [active, pending, suspended, deactivated]
        createdAt:
          type: string
          format: date-time

    UserDetail:
      allOf:
        - $ref: '#/components/schemas/User'
        - type: object
          properties:
            teams:
              type: array
              items:
                $ref: '#/components/schemas/TeamMembership'
            permissions:
              type: array
              items:
                type: string
            mfaEnabled:
              type: boolean
            lastLoginAt:
              type: string
              format: date-time
            lastActiveAt:
              type: string
              format: date-time

    UserListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/User'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    UserRole:
      type: string
      enum: [super-admin, tenant-admin, platform-admin, developer, viewer]

    CreateUserRequest:
      type: object
      required: [email, name, role]
      properties:
        email:
          type: string
          format: email
        name:
          type: string
        role:
          $ref: '#/components/schemas/UserRole'
        teamIds:
          type: array
          items:
            type: string
            format: uuid
        sendInvite:
          type: boolean
          default: true

    UpdateUserRequest:
      type: object
      properties:
        name:
          type: string
        role:
          $ref: '#/components/schemas/UserRole'
        avatarUrl:
          type: string

    ApiKey:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        prefix:
          type: string
        scopes:
          type: array
          items:
            type: string
        lastUsedAt:
          type: string
          format: date-time
        expiresAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    ApiKeyWithSecret:
      allOf:
        - $ref: '#/components/schemas/ApiKey'
        - type: object
          properties:
            secret:
              type: string
              description: Only shown once at creation

    ApiKeyListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/ApiKey'

    CreateApiKeyRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        scopes:
          type: array
          items:
            type: string
        expiresAt:
          type: string
          format: date-time

    SessionListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              device:
                type: string
              ipAddress:
                type: string
              location:
                type: string
              lastActiveAt:
                type: string
                format: date-time
              createdAt:
                type: string
                format: date-time
              current:
                type: boolean

    # ===== Entities =====
    EntityType:
      type: string
      enum: [Service, API, Module, Database, Component, Team, Repository, Package, Function, Class, Interface, Endpoint, Queue, Cache, Document, Ticket, ADR, Epic, Story, User]

    Entity:
      type: object
      properties:
        id:
          type: string
          format: uuid
        type:
          $ref: '#/components/schemas/EntityType'
        name:
          type: string
        description:
          type: string
        source:
          type: string
        sourceId:
          type: string
        properties:
          type: object
        health:
          $ref: '#/components/schemas/HealthStatus'
        teamId:
          type: string
          format: uuid
        communityId:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    EntityDetail:
      allOf:
        - $ref: '#/components/schemas/Entity'
        - type: object
          properties:
            inboundRelationships:
              type: integer
            outboundRelationships:
              type: integer
            violationCount:
              type: integer
            documentationCoverage:
              type: number
            lastSyncedAt:
              type: string
              format: date-time
            metadata:
              type: object

    EntityListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Entity'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    CreateEntityRequest:
      type: object
      required: [type, name]
      properties:
        type:
          $ref: '#/components/schemas/EntityType'
        name:
          type: string
        description:
          type: string
        properties:
          type: object
        teamId:
          type: string
          format: uuid
        projectId:
          type: string
          format: uuid

    UpdateEntityRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        properties:
          type: object
        teamId:
          type: string
          format: uuid
        health:
          $ref: '#/components/schemas/HealthStatus'

    BulkCreateResponse:
      type: object
      properties:
        created:
          type: integer
        failed:
          type: integer
        errors:
          type: array
          items:
            type: object
            properties:
              index:
                type: integer
              error:
                type: string

    EntityHistoryResponse:
      type: object
      properties:
        data:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              action:
                type: string
                enum: [created, updated, deleted]
              changes:
                type: object
              userId:
                type: string
                format: uuid
              timestamp:
                type: string
                format: date-time
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    HealthStatus:
      type: string
      enum: [healthy, warning, critical, unknown]

    # ===== Relationships =====
    RelationshipType:
      type: string
      enum: [depends_on, calls, imports, owns, maintains, reads_from, writes_to, deploys_to, implements, exposes, documents, references, requires, violates]

    Relationship:
      type: object
      properties:
        id:
          type: string
          format: uuid
        sourceId:
          type: string
          format: uuid
        targetId:
          type: string
          format: uuid
        type:
          $ref: '#/components/schemas/RelationshipType'
        properties:
          type: object
        isIntent:
          type: boolean
          description: True if documented/intended, false if observed
        confidence:
          type: number
        source:
          type: string
        createdAt:
          type: string
          format: date-time

    RelationshipDetail:
      allOf:
        - $ref: '#/components/schemas/Relationship'
        - type: object
          properties:
            sourceEntity:
              $ref: '#/components/schemas/Entity'
            targetEntity:
              $ref: '#/components/schemas/Entity'

    RelationshipListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Relationship'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    CreateRelationshipRequest:
      type: object
      required: [sourceId, targetId, type]
      properties:
        sourceId:
          type: string
          format: uuid
        targetId:
          type: string
          format: uuid
        type:
          $ref: '#/components/schemas/RelationshipType'
        properties:
          type: object
        isIntent:
          type: boolean
          default: true

    RelationshipGraphResponse:
      type: object
      properties:
        nodes:
          type: array
          items:
            $ref: '#/components/schemas/Entity'
        edges:
          type: array
          items:
            $ref: '#/components/schemas/Relationship'

    ContextGraphResponse:
      type: object
      properties:
        rootEntity:
          $ref: '#/components/schemas/Entity'
        nodes:
          type: array
          items:
            $ref: '#/components/schemas/Entity'
        edges:
          type: array
          items:
            $ref: '#/components/schemas/Relationship'
        communities:
          type: array
          items:
            $ref: '#/components/schemas/Community'

    GraphResponse:
      type: object
      properties:
        nodes:
          type: array
          items:
            $ref: '#/components/schemas/GraphNode'
        edges:
          type: array
          items:
            $ref: '#/components/schemas/GraphEdge'
        communities:
          type: array
          items:
            $ref: '#/components/schemas/Community'
        metadata:
          type: object
          properties:
            totalNodes:
              type: integer
            totalEdges:
              type: integer
            driftEdgesCount:
              type: integer
            lastUpdated:
              type: string
              format: date-time

    GraphNode:
      type: object
      properties:
        id:
          type: string
        type:
          $ref: '#/components/schemas/EntityType'
        label:
          type: string
        properties:
          type: object
        health:
          $ref: '#/components/schemas/HealthStatus'
        position:
          type: object
          properties:
            x:
              type: number
            y:
              type: number
        communityId:
          type: string
        size:
          type: number
        color:
          type: string

    GraphEdge:
      type: object
      properties:
        id:
          type: string
        source:
          type: string
        target:
          type: string
        type:
          $ref: '#/components/schemas/RelationshipType'
        properties:
          type: object
        isIntent:
          type: boolean
        weight:
          type: number
        color:
          type: string

    GraphSearchRequest:
      type: object
      properties:
        query:
          type: string
        entityTypes:
          type: array
          items:
            $ref: '#/components/schemas/EntityType'
        relationshipTypes:
          type: array
          items:
            $ref: '#/components/schemas/RelationshipType'
        projectId:
          type: string
          format: uuid
        teamId:
          type: string
          format: uuid
        communityId:
          type: string
        healthStatus:
          type: array
          items:
            $ref: '#/components/schemas/HealthStatus'
        lens:
          type: string
          enum: [reality, intent, drift, ownership, health]
        maxNodes:
          type: integer
          default: 500

    PathsResponse:
      type: object
      properties:
        paths:
          type: array
          items:
            type: object
            properties:
              nodes:
                type: array
                items:
                  $ref: '#/components/schemas/Entity'
              edges:
                type: array
                items:
                  $ref: '#/components/schemas/Relationship'
              length:
                type: integer
        totalPaths:
          type: integer

    # ===== GraphRAG =====
    GraphRAGQueryRequest:
      type: object
      required: [query]
      properties:
        query:
          type: string
        strategy:
          type: string
          enum: [local, global, drift]
          default: drift
        communityLevel:
          type: integer
          minimum: 0
          maximum: 3
          default: 1
        maxTokens:
          type: integer
          default: 4000
        includeEvidence:
          type: boolean
          default: true
        projectId:
          type: string
          format: uuid

    GraphRAGQueryResponse:
      type: object
      properties:
        answer:
          type: string
        strategy:
          type: string
        evidence:
          type: array
          items:
            $ref: '#/components/schemas/Evidence'
        communities:
          type: array
          items:
            $ref: '#/components/schemas/CommunityReference'
        entities:
          type: array
          items:
            $ref: '#/components/schemas/Entity'
        confidence:
          type: number
        tokenUsage:
          type: object
          properties:
            prompt:
              type: integer
            completion:
              type: integer
        latencyMs:
          type: integer

    Evidence:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [text_unit, entity, relationship, community_report]
        content:
          type: string
        source:
          type: string
        relevanceScore:
          type: number

    CommunityReference:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        level:
          type: integer
        relevance:
          type: number

    IndexRequest:
      type: object
      properties:
        scope:
          type: string
          enum: [full, incremental]
          default: incremental
        projectId:
          type: string
          format: uuid
        connectionIds:
          type: array
          items:
            type: string
            format: uuid

    IndexTaskResponse:
      type: object
      properties:
        taskId:
          type: string
          format: uuid
        status:
          type: string
          enum: [queued, running, completed, failed]
        createdAt:
          type: string
          format: date-time

    IndexTaskStatus:
      type: object
      properties:
        taskId:
          type: string
          format: uuid
        status:
          type: string
          enum: [queued, running, completed, failed, cancelled]
        progress:
          type: object
          properties:
            phase:
              type: string
            current:
              type: integer
            total:
              type: integer
            percentage:
              type: number
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        error:
          type: string
        stats:
          type: object
          properties:
            documentsProcessed:
              type: integer
            entitiesExtracted:
              type: integer
            relationshipsExtracted:
              type: integer
            communitiesDetected:
              type: integer

    IndexingOverview:
      type: object
      properties:
        lastFullIndex:
          type: string
          format: date-time
        lastIncrementalIndex:
          type: string
          format: date-time
        activeTasks:
          type: array
          items:
            $ref: '#/components/schemas/IndexTaskStatus'
        stats:
          type: object
          properties:
            totalDocuments:
              type: integer
            totalEntities:
              type: integer
            totalRelationships:
              type: integer
            totalCommunities:
              type: integer

    Community:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        summary:
          type: string
        level:
          type: integer
        memberCount:
          type: integer
        parentId:
          type: string

    CommunityDetail:
      allOf:
        - $ref: '#/components/schemas/Community'
        - type: object
          properties:
            members:
              type: array
              items:
                $ref: '#/components/schemas/Entity'
            report:
              type: string
            findings:
              type: array
              items:
                type: string
            children:
              type: array
              items:
                $ref: '#/components/schemas/Community'

    CommunityListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Community'
        meta:
          type: object
          properties:
            level:
              type: integer
            totalCommunities:
              type: integer

    QueryHistoryResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/QueryHistoryEntry'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    QueryHistoryEntry:
      type: object
      properties:
        id:
          type: string
          format: uuid
        query:
          type: string
        strategy:
          type: string
        answer:
          type: string
        evidence:
          type: array
          items:
            $ref: '#/components/schemas/Evidence'
        userId:
          type: string
          format: uuid
        tokenUsage:
          type: object
        latencyMs:
          type: integer
        createdAt:
          type: string
          format: date-time

    # ===== Policies =====
    PolicyCategory:
      type: string
      enum: [architecture, security, compliance, ownership, documentation, dependency, custom]

    EnforcementMode:
      type: string
      enum: [advisory, soft-mandatory, hard-mandatory]

    Policy:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        category:
          $ref: '#/components/schemas/PolicyCategory'
        rego:
          type: string
        enabled:
          type: boolean
        enforcementMode:
          $ref: '#/components/schemas/EnforcementMode'
        version:
          type: integer
        violationCount:
          type: integer
        projectId:
          type: string
          format: uuid
        createdBy:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PolicyDetail:
      allOf:
        - $ref: '#/components/schemas/Policy'
        - type: object
          properties:
            recentViolations:
              type: array
              items:
                $ref: '#/components/schemas/Violation'
            affectedEntities:
              type: integer
            lastEvaluatedAt:
              type: string
              format: date-time
            metadata:
              type: object

    PolicyListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Policy'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    CreatePolicyRequest:
      type: object
      required: [name, category, rego]
      properties:
        name:
          type: string
        description:
          type: string
        category:
          $ref: '#/components/schemas/PolicyCategory'
        rego:
          type: string
        enabled:
          type: boolean
          default: false
        enforcementMode:
          $ref: '#/components/schemas/EnforcementMode'
          default: advisory
        projectId:
          type: string
          format: uuid

    UpdatePolicyRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        rego:
          type: string
        enabled:
          type: boolean
        enforcementMode:
          $ref: '#/components/schemas/EnforcementMode'

    PolicyTestRequest:
      type: object
      required: [input]
      properties:
        input:
          type: object
        verbose:
          type: boolean
          default: false

    PolicyTestResponse:
      type: object
      properties:
        passed:
          type: boolean
        violations:
          type: array
          items:
            type: object
            properties:
              rule:
                type: string
              message:
                type: string
              path:
                type: array
                items:
                  type: string
        warnings:
          type: array
          items:
            type: string
        executionTimeMs:
          type: integer
        trace:
          type: array
          items:
            type: string

    PolicyVersionListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            type: object
            properties:
              version:
                type: integer
              rego:
                type: string
              createdBy:
                type: string
                format: uuid
              createdAt:
                type: string
                format: date-time
              comment:
                type: string

    EvaluationRequest:
      type: object
      required: [input]
      properties:
        input:
          type: object
        policyIds:
          type: array
          items:
            type: string
            format: uuid
        projectId:
          type: string
          format: uuid

    EvaluationResponse:
      type: object
      properties:
        passed:
          type: boolean
        results:
          type: array
          items:
            type: object
            properties:
              policyId:
                type: string
                format: uuid
              policyName:
                type: string
              passed:
                type: boolean
              violations:
                type: array
                items:
                  type: object
                  properties:
                    message:
                      type: string
                    severity:
                      $ref: '#/components/schemas/Severity'
                    entityId:
                      type: string
                      format: uuid
              enforcementMode:
                $ref: '#/components/schemas/EnforcementMode'
        totalPolicies:
          type: integer
        passedCount:
          type: integer
        failedCount:
          type: integer
        executionTimeMs:
          type: integer

    BatchEvaluationResponse:
      type: object
      properties:
        results:
          type: array
          items:
            $ref: '#/components/schemas/EvaluationResponse'
        summary:
          type: object
          properties:
            totalInputs:
              type: integer
            passedInputs:
              type: integer
            failedInputs:
              type: integer

    # ===== Violations =====
    Severity:
      type: string
      enum: [critical, high, medium, low, info]

    ViolationStatus:
      type: string
      enum: [open, acknowledged, resolved, suppressed, auto-resolved]

    Violation:
      type: object
      properties:
        id:
          type: string
          format: uuid
        policyId:
          type: string
          format: uuid
        policyName:
          type: string
        entityId:
          type: string
          format: uuid
        entityName:
          type: string
        entityType:
          $ref: '#/components/schemas/EntityType'
        message:
          type: string
        severity:
          $ref: '#/components/schemas/Severity'
        status:
          $ref: '#/components/schemas/ViolationStatus'
        teamId:
          type: string
          format: uuid
        projectId:
          type: string
          format: uuid
        detectedAt:
          type: string
          format: date-time
        resolvedAt:
          type: string
          format: date-time

    ViolationDetail:
      allOf:
        - $ref: '#/components/schemas/Violation'
        - type: object
          properties:
            entity:
              $ref: '#/components/schemas/Entity'
            policy:
              $ref: '#/components/schemas/Policy'
            context:
              type: object
            history:
              type: array
              items:
                type: object
                properties:
                  action:
                    type: string
                  userId:
                    type: string
                    format: uuid
                  timestamp:
                    type: string
                    format: date-time
                  comment:
                    type: string
            suppressionInfo:
              type: object
              properties:
                reason:
                  type: string
                suppressedBy:
                  type: string
                  format: uuid
                expiresAt:
                  type: string
                  format: date-time

    ViolationListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Violation'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    ViolationsSummary:
      type: object
      properties:
        total:
          type: integer
        bySeverity:
          type: object
          properties:
            critical:
              type: integer
            high:
              type: integer
            medium:
              type: integer
            low:
              type: integer
            info:
              type: integer
        byStatus:
          type: object
          properties:
            open:
              type: integer
            acknowledged:
              type: integer
            resolved:
              type: integer
            suppressed:
              type: integer
        byCategory:
          type: object
          additionalProperties:
            type: integer
        trend:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              count:
                type: integer

    UpdateViolationRequest:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/ViolationStatus'
        comment:
          type: string

    # ===== Policy Generation (LACE) =====
    PolicyGenerationRequest:
      type: object
      required: [description]
      properties:
        description:
          type: string
          example: "Services in payment domain must not directly call services in user domain"
        category:
          $ref: '#/components/schemas/PolicyCategory'
        examples:
          type: array
          items:
            type: object
            properties:
              input:
                type: object
              expectedResult:
                type: string
                enum: [allow, deny]
        constraints:
          type: array
          items:
            type: string
        existingPolicies:
          type: array
          items:
            type: string
            format: uuid

    PolicyGenerationResponse:
      type: object
      properties:
        rego:
          type: string
        explanation:
          type: string
        confidence:
          type: number
          minimum: 0
          maximum: 1
        validation:
          type: object
          properties:
            syntaxValid:
              type: boolean
            testResults:
              type: array
              items:
                type: object
                properties:
                  example:
                    type: object
                  expected:
                    type: string
                  actual:
                    type: string
                  passed:
                    type: boolean
        alternatives:
          type: array
          items:
            type: object
            properties:
              rego:
                type: string
              description:
                type: string
        warnings:
          type: array
          items:
            type: string

    PolicyRefinementRequest:
      type: object
      required: [rego, feedback]
      properties:
        rego:
          type: string
        feedback:
          type: string
        failedTests:
          type: array
          items:
            type: object
            properties:
              input:
                type: object
              expected:
                type: string
              actual:
                type: string

    PolicyExample:
      type: object
      properties:
        id:
          type: string
        category:
          $ref: '#/components/schemas/PolicyCategory'
        title:
          type: string
        description:
          type: string
        rego:
          type: string
        tags:
          type: array
          items:
            type: string

    RegoValidationResponse:
      type: object
      properties:
        valid:
          type: boolean
        errors:
          type: array
          items:
            type: object
            properties:
              line:
                type: integer
              column:
                type: integer
              message:
                type: string
        warnings:
          type: array
          items:
            type: string

    # ===== Impact Analysis =====
    ImpactAnalysisRequest:
      type: object
      required: [entityIds]
      properties:
        entityIds:
          type: array
          items:
            type: string
            format: uuid
        changeType:
          type: string
          enum: [modify, delete, deprecate]
          default: modify
        maxHops:
          type: integer
          default: 3
          maximum: 5
        includeIndirect:
          type: boolean
          default: true

    ImpactAnalysisResponse:
      type: object
      properties:
        directlyAffected:
          type: array
          items:
            $ref: '#/components/schemas/AffectedEntity'
        indirectlyAffected:
          type: array
          items:
            $ref: '#/components/schemas/AffectedEntity'
        policiesTriggered:
          type: array
          items:
            type: object
            properties:
              policyId:
                type: string
                format: uuid
              policyName:
                type: string
              severity:
                $ref: '#/components/schemas/Severity'
              message:
                type: string
        riskAssessment:
          type: object
          properties:
            overallRisk:
              type: string
              enum: [low, medium, high, critical]
            factors:
              type: array
              items:
                type: object
                properties:
                  factor:
                    type: string
                  weight:
                    type: number
                  description:
                    type: string
        visualization:
          $ref: '#/components/schemas/GraphResponse'
        summary:
          type: object
          properties:
            totalAffected:
              type: integer
            byType:
              type: object
              additionalProperties:
                type: integer
            byTeam:
              type: object
              additionalProperties:
                type: integer

    AffectedEntity:
      type: object
      properties:
        entity:
          $ref: '#/components/schemas/Entity'
        impactType:
          type: string
          enum: [breaking, non-breaking, potential]
        distance:
          type: integer
        path:
          type: array
          items:
            type: string
            format: uuid
        reason:
          type: string

    ChangeSimulationRequest:
      type: object
      required: [changes]
      properties:
        changes:
          type: array
          items:
            type: object
            required: [type]
            properties:
              type:
                type: string
                enum: [add_entity, remove_entity, modify_entity, add_relationship, remove_relationship]
              entityId:
                type: string
                format: uuid
              newEntity:
                $ref: '#/components/schemas/CreateEntityRequest'
              updates:
                type: object
              relationship:
                $ref: '#/components/schemas/CreateRelationshipRequest'
        policyIds:
          type: array
          items:
            type: string
            format: uuid

    ChangeSimulationResponse:
      type: object
      properties:
        proposedState:
          $ref: '#/components/schemas/GraphResponse'
        newViolations:
          type: array
          items:
            type: object
            properties:
              policyId:
                type: string
                format: uuid
              policyName:
                type: string
              severity:
                $ref: '#/components/schemas/Severity'
              message:
                type: string
              affectedEntity:
                type: string
                format: uuid
        resolvedViolations:
          type: array
          items:
            type: string
            format: uuid
        impactSummary:
          type: object
          properties:
            entitiesAffected:
              type: integer
            newViolationCount:
              type: integer
            resolvedViolationCount:
              type: integer
            riskLevel:
              type: string
              enum: [low, medium, high, critical]
        canProceed:
          type: boolean
        blockingViolations:
          type: array
          items:
            type: string

    WhatIfRequest:
      type: object
      required: [scenario]
      properties:
        scenario:
          type: string
          enum: [entity_removal, dependency_addition, team_change, technology_migration]
        parameters:
          type: object
          properties:
            entityId:
              type: string
              format: uuid
            sourceId:
              type: string
              format: uuid
            targetId:
              type: string
              format: uuid
            newTeamId:
              type: string
              format: uuid
            fromTechnology:
              type: string
            toTechnology:
              type: string

    WhatIfResponse:
      type: object
      properties:
        scenario:
          type: string
        feasibility:
          type: string
          enum: [feasible, risky, not_recommended, blocked]
        impacts:
          type: array
          items:
            type: object
            properties:
              category:
                type: string
              description:
                type: string
              severity:
                $ref: '#/components/schemas/Severity'
              affectedCount:
                type: integer
        recommendations:
          type: array
          items:
            type: string
        prerequisites:
          type: array
          items:
            type: string
        estimatedEffort:
          type: object
          properties:
            complexity:
              type: string
              enum: [low, medium, high]
            entities:
              type: integer
            teams:
              type: integer

    DependencyCheckResponse:
      type: object
      properties:
        canDelete:
          type: boolean
        dependents:
          type: array
          items:
            type: object
            properties:
              entity:
                $ref: '#/components/schemas/Entity'
              relationshipType:
                $ref: '#/components/schemas/RelationshipType'
              critical:
                type: boolean
        warnings:
          type: array
          items:
            type: string
        suggestedActions:
          type: array
          items:
            type: string

    # ===== Marketplace =====
    PluginCategory:
      type: string
      enum: [source-control, issue-tracking, documentation, cloud-provider, ci-cd, communication, monitoring, security, policy-pack, visualization, custom]

    Plugin:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        category:
          $ref: '#/components/schemas/PluginCategory'
        type:
          type: string
          enum: [connector, policy-pack, visualization, integration]
        author:
          type: string
        authorUrl:
          type: string
        iconUrl:
          type: string
        version:
          type: string
        verified:
          type: boolean
        downloads:
          type: integer
        rating:
          type: number
        ratingCount:
          type: integer
        tags:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PluginDetail:
      allOf:
        - $ref: '#/components/schemas/Plugin'
        - type: object
          properties:
            fullDescription:
              type: string
            screenshots:
              type: array
              items:
                type: string
            documentation:
              type: string
            supportUrl:
              type: string
            configSchema:
              type: object
            permissions:
              type: array
              items:
                type: string
            requirements:
              type: object
              properties:
                minPlatformVersion:
                  type: string
                dependencies:
                  type: array
                  items:
                    type: string
            changelog:
              type: array
              items:
                $ref: '#/components/schemas/ChangelogEntry'

    PluginCatalogResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Plugin'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    PluginVersionListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            type: object
            properties:
              version:
                type: string
              releaseDate:
                type: string
                format: date-time
              changelog:
                type: string
              minPlatformVersion:
                type: string

    ChangelogEntry:
      type: object
      properties:
        version:
          type: string
        date:
          type: string
          format: date
        changes:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
                enum: [added, changed, fixed, removed, security]
              description:
                type: string

    PluginReview:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        userName:
          type: string
        rating:
          type: integer
          minimum: 1
          maximum: 5
        title:
          type: string
        content:
          type: string
        version:
          type: string
        helpful:
          type: integer
        createdAt:
          type: string
          format: date-time

    PluginReviewListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/PluginReview'
        meta:
          $ref: '#/components/schemas/PaginationMeta'
        summary:
          type: object
          properties:
            averageRating:
              type: number
            totalReviews:
              type: integer
            distribution:
              type: object

    CreatePluginReviewRequest:
      type: object
      required: [rating]
      properties:
        rating:
          type: integer
          minimum: 1
          maximum: 5
        title:
          type: string
        content:
          type: string

    PluginCategoryInfo:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/PluginCategory'
        name:
          type: string
        description:
          type: string
        iconUrl:
          type: string
        pluginCount:
          type: integer

    InstalledPlugin:
      type: object
      properties:
        id:
          type: string
          format: uuid
        pluginId:
          type: string
        pluginName:
          type: string
        version:
          type: string
        status:
          type: string
          enum: [active, disabled, pending-update, error]
        autoUpdate:
          type: boolean
        installedAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        installedBy:
          type: string
          format: uuid
        config:
          type: object
        healthStatus:
          type: string
          enum: [healthy, degraded, unhealthy]
        lastError:
          type: string

    InstalledPluginListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/InstalledPlugin'

    PluginInstallationStatus:
      type: object
      properties:
        installationId:
          type: string
          format: uuid
        status:
          type: string
          enum: [pending, installing, configuring, active, failed]
        progress:
          type: integer
        message:
          type: string

    PluginConfig:
      type: object
      properties:
        installationId:
          type: string
          format: uuid
        schema:
          type: object
        values:
          type: object
        defaults:
          type: object

    # ===== Connectors =====
    ConnectionStatus:
      type: string
      enum: [connected, disconnected, error, syncing, pending]

    Connection:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        pluginId:
          type: string
        pluginName:
          type: string
        status:
          $ref: '#/components/schemas/ConnectionStatus'
        lastSyncAt:
          type: string
          format: date-time
        nextSyncAt:
          type: string
          format: date-time
        entityCount:
          type: integer
        projectIds:
          type: array
          items:
            type: string
            format: uuid
        createdAt:
          type: string
          format: date-time

    ConnectionDetail:
      allOf:
        - $ref: '#/components/schemas/Connection'
        - type: object
          properties:
            config:
              type: object
            syncSchedule:
              type: string
            healthHistory:
              type: array
              items:
                type: object
                properties:
                  timestamp:
                    type: string
                    format: date-time
                  status:
                    $ref: '#/components/schemas/ConnectionStatus'
            stats:
              type: object
              properties:
                totalEntities:
                  type: integer
                entitiesByType:
                  type: object
                  additionalProperties:
                    type: integer
                lastSyncDuration:
                  type: integer
                avgSyncDuration:
                  type: integer

    ConnectionListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Connection'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    CreateConnectionRequest:
      type: object
      required: [name, pluginId]
      properties:
        name:
          type: string
        pluginId:
          type: string
        config:
          type: object
        syncSchedule:
          type: string
        projectIds:
          type: array
          items:
            type: string
            format: uuid

    UpdateConnectionRequest:
      type: object
      properties:
        name:
          type: string
        config:
          type: object
        syncSchedule:
          type: string
        projectIds:
          type: array
          items:
            type: string
            format: uuid

    ConnectionTestResult:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        details:
          type: object
          properties:
            latencyMs:
              type: integer
            permissions:
              type: array
              items:
                type: object
                properties:
                  permission:
                    type: string
                  granted:
                    type: boolean
            resources:
              type: object

    SyncTask:
      type: object
      properties:
        taskId:
          type: string
          format: uuid
        connectionId:
          type: string
          format: uuid
        status:
          type: string
          enum: [queued, running, completed, failed, cancelled]
        fullSync:
          type: boolean
        startedAt:
          type: string
          format: date-time

    SyncTaskStatus:
      type: object
      properties:
        taskId:
          type: string
          format: uuid
        status:
          type: string
          enum: [queued, running, completed, failed, cancelled]
        progress:
          type: object
          properties:
            phase:
              type: string
            current:
              type: integer
            total:
              type: integer
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        stats:
          type: object
          properties:
            entitiesCreated:
              type: integer
            entitiesUpdated:
              type: integer
            entitiesDeleted:
              type: integer
            relationshipsCreated:
              type: integer
            errors:
              type: integer
        error:
          type: string

    SyncHistoryResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/SyncTaskStatus'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    ConnectionLogResponse:
      type: object
      properties:
        data:
          type: array
          items:
            type: object
            properties:
              timestamp:
                type: string
                format: date-time
              level:
                type: string
                enum: [debug, info, warn, error]
              message:
                type: string
              metadata:
                type: object

    # ===== Webhooks =====
    WebhookResponse:
      type: object
      properties:
        received:
          type: boolean
        eventId:
          type: string
        processed:
          type: boolean
        message:
          type: string

    WebhookConfig:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        url:
          type: string
        provider:
          type: string
          enum: [github, gitlab, jira, confluence, slack, custom]
        events:
          type: array
          items:
            type: string
        enabled:
          type: boolean
        secret:
          type: string
        connectionId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time

    WebhookConfigListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/WebhookConfig'

    CreateWebhookRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        provider:
          type: string
          enum: [custom]
          default: custom
        events:
          type: array
          items:
            type: string
        connectionId:
          type: string
          format: uuid

    UpdateWebhookRequest:
      type: object
      properties:
        name:
          type: string
        events:
          type: array
          items:
            type: string
        enabled:
          type: boolean

    WebhookDeliveryListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              event:
                type: string
              status:
                type: string
                enum: [success, failed, pending]
              statusCode:
                type: integer
              duration:
                type: integer
              requestHeaders:
                type: object
              requestBody:
                type: object
              responseBody:
                type: string
              error:
                type: string
              timestamp:
                type: string
                format: date-time
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    # ===== Metrics =====
    HealthScore:
      type: object
      properties:
        overall:
          type: number
          minimum: 0
          maximum: 100
        grade:
          type: string
          enum: [A, B, C, D, F]
        trend:
          type: string
          enum: [improving, stable, declining]
        dimensions:
          type: object
          properties:
            architecture:
              type: number
            documentation:
              type: number
            compliance:
              type: number
            security:
              type: number
            maintainability:
              type: number
        lastCalculated:
          type: string
          format: date-time

    HealthHistoryResponse:
      type: object
      properties:
        data:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              overall:
                type: number
              dimensions:
                type: object

    DriftMetrics:
      type: object
      properties:
        intentRealityGap:
          type: number
        driftEdges:
          type: integer
        shadowDependencies:
          type: integer
        undocumentedServices:
          type: integer
        outdatedDocumentation:
          type: integer
        byCategory:
          type: object
          additionalProperties:
            type: number
        trend:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              gap:
                type: number

    ComplianceMetrics:
      type: object
      properties:
        overallCompliance:
          type: number
        byPolicy:
          type: array
          items:
            type: object
            properties:
              policyId:
                type: string
                format: uuid
              policyName:
                type: string
              compliance:
                type: number
              violations:
                type: integer
        byCategory:
          type: object
          additionalProperties:
            type: number
        frameworks:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              compliance:
                type: number
              controls:
                type: object
                properties:
                  total:
                    type: integer
                  passing:
                    type: integer
                  failing:
                    type: integer

    DORAMetrics:
      type: object
      properties:
        deploymentFrequency:
          type: object
          properties:
            value:
              type: number
            unit:
              type: string
            level:
              type: string
              enum: [elite, high, medium, low]
        leadTimeForChanges:
          type: object
          properties:
            value:
              type: number
            unit:
              type: string
            level:
              type: string
              enum: [elite, high, medium, low]
        changeFailureRate:
          type: object
          properties:
            value:
              type: number
            level:
              type: string
              enum: [elite, high, medium, low]
        timeToRestoreService:
          type: object
          properties:
            value:
              type: number
            unit:
              type: string
            level:
              type: string
              enum: [elite, high, medium, low]
        overallLevel:
          type: string
          enum: [elite, high, medium, low]
        period:
          type: object
          properties:
            start:
              type: string
              format: date
            end:
              type: string
              format: date

    KnowledgeGraphMetrics:
      type: object
      properties:
        totalEntities:
          type: integer
        totalRelationships:
          type: integer
        totalCommunities:
          type: integer
        entitiesByType:
          type: object
          additionalProperties:
            type: integer
        relationshipsByType:
          type: object
          additionalProperties:
            type: integer
        graphDensity:
          type: number
        avgDegree:
          type: number
        connectedComponents:
          type: integer
        lastUpdated:
          type: string
          format: date-time

    DocumentationMetrics:
      type: object
      properties:
        coverage:
          type: number
        freshness:
          type: number
        averageStaleness:
          type: number
        totalDocuments:
          type: integer
        staleDocuments:
          type: integer
        orphanedDocuments:
          type: integer
        undocumentedEntities:
          type: integer
        linkRotRate:
          type: number

    TechnicalDebtMetrics:
      type: object
      properties:
        totalDebt:
          type: number
        debtRatio:
          type: number
        byCategory:
          type: object
          properties:
            architecture:
              type: number
            documentation:
              type: number
            dependencies:
              type: number
            testing:
              type: number
        topContributors:
          type: array
          items:
            type: object
            properties:
              entityId:
                type: string
                format: uuid
              entityName:
                type: string
              debtScore:
                type: number
        trend:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              debt:
                type: number

    # ===== Maintenance =====
    StalenessReport:
      type: object
      properties:
        documentId:
          type: string
          format: uuid
        score:
          type: number
          minimum: 0
          maximum: 1
        components:
          type: object
          properties:
            timeDecay:
              type: object
              properties:
                score:
                  type: number
                weight:
                  type: number
                lastUpdated:
                  type: string
                  format: date-time
            codeDrift:
              type: object
              properties:
                score:
                  type: number
                weight:
                  type: number
                changedReferences:
                  type: integer
                totalReferences:
                  type: integer
            linkRot:
              type: object
              properties:
                score:
                  type: number
                weight:
                  type: number
                brokenLinks:
                  type: integer
                totalLinks:
                  type: integer
            referenceValidity:
              type: object
              properties:
                score:
                  type: number
                weight:
                  type: number
                invalidSymbols:
                  type: integer
            viewFrequency:
              type: object
              properties:
                score:
                  type: number
                weight:
                  type: number
                recentViews:
                  type: integer
        recommendation:
          type: string
          enum: [keep, update, archive, delete]
        suggestedActions:
          type: array
          items:
            type: string

    StaleDocumentListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            type: object
            properties:
              documentId:
                type: string
                format: uuid
              name:
                type: string
              score:
                type: number
              lastUpdated:
                type: string
                format: date-time
              ownerTeam:
                type: string
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    MaintenanceTaskResponse:
      type: object
      properties:
        taskId:
          type: string
          format: uuid
        type:
          type: string
        status:
          type: string
          enum: [queued, running, completed, failed]
        startedAt:
          type: string
          format: date-time

    DuplicateReport:
      type: object
      properties:
        clusters:
          type: array
          items:
            type: object
            properties:
              clusterId:
                type: string
              similarity:
                type: number
              documents:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                    name:
                      type: string
                    source:
                      type: string
              recommendation:
                type: string
                enum: [auto-merge, suggest-merge, suggest-link]
        totalClusters:
          type: integer
        scannedDocuments:
          type: integer
        lastScan:
          type: string
          format: date-time

    LinkValidationReport:
      type: object
      properties:
        summary:
          type: object
          properties:
            total:
              type: integer
            valid:
              type: integer
            broken:
              type: integer
            redirected:
              type: integer
        brokenLinks:
          type: array
          items:
            type: object
            properties:
              url:
                type: string
              documentId:
                type: string
                format: uuid
              documentName:
                type: string
              statusCode:
                type: integer
              error:
                type: string
        redirectedLinks:
          type: array
          items:
            type: object
            properties:
              originalUrl:
                type: string
              redirectUrl:
                type: string
              documentId:
                type: string
                format: uuid
        lastScan:
          type: string
          format: date-time

    ReviewItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        type:
          type: string
          enum: [staleness, duplicate, enrichment, merge]
        status:
          type: string
          enum: [pending, in-progress, approved, rejected]
        priority:
          type: string
          enum: [low, medium, high]
        subject:
          type: object
        suggestedAction:
          type: string
        confidence:
          type: number
        assigneeId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ReviewListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/ReviewItem'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    ReviewDecisionRequest:
      type: object
      required: [decision]
      properties:
        decision:
          type: string
          enum: [approve, reject, modify]
        comment:
          type: string
        modifications:
          type: object

    # ===== Export =====
    GraphExportRequest:
      type: object
      properties:
        format:
          type: string
          enum: [json, graphml, gexf, csv]
          default: json
        scope:
          type: object
          properties:
            projectId:
              type: string
              format: uuid
            teamId:
              type: string
              format: uuid
            entityTypes:
              type: array
              items:
                $ref: '#/components/schemas/EntityType'
        includeProperties:
          type: boolean
          default: true
        includeHistory:
          type: boolean
          default: false

    ReportRequest:
      type: object
      required: [type]
      properties:
        type:
          type: string
          enum: [health, compliance, drift, architecture, executive]
        format:
          type: string
          enum: [pdf, html, markdown]
          default: pdf
        scope:
          type: object
          properties:
            projectId:
              type: string
              format: uuid
            teamId:
              type: string
              format: uuid
        dateRange:
          type: object
          properties:
            start:
              type: string
              format: date
            end:
              type: string
              format: date
        options:
          type: object
          properties:
            includeCharts:
              type: boolean
              default: true
            includeRecommendations:
              type: boolean
              default: true
            executiveSummary:
              type: boolean
              default: true

    ComplianceReportRequest:
      type: object
      required: [framework]
      properties:
        framework:
          type: string
          enum: [soc2, hipaa, gdpr, iso27001, pci-dss, custom]
        format:
          type: string
          enum: [pdf, html, json]
          default: pdf
        projectId:
          type: string
          format: uuid
        includeEvidence:
          type: boolean
          default: true
        includeRemediations:
          type: boolean
          default: true

    MetricsExportRequest:
      type: object
      properties:
        metrics:
          type: array
          items:
            type: string
            enum: [health, drift, compliance, dora, documentation]
        format:
          type: string
          enum: [csv, json]
          default: csv
        dateRange:
          type: object
          properties:
            start:
              type: string
              format: date
            end:
              type: string
              format: date
        granularity:
          type: string
          enum: [daily, weekly, monthly]

    DiagramExportRequest:
      type: object
      properties:
        style:
          type: string
          enum: [c4, uml, simple, detailed]
          default: simple
        scope:
          type: object
          properties:
            entityIds:
              type: array
              items:
                type: string
                format: uuid
            projectId:
              type: string
              format: uuid
            maxHops:
              type: integer
              default: 2
        options:
          type: object
          properties:
            showLabels:
              type: boolean
              default: true
            showLegend:
              type: boolean
              default: true
            colorScheme:
              type: string
              enum: [default, grayscale, colorblind-safe]

    ExportTaskResponse:
      type: object
      properties:
        taskId:
          type: string
          format: uuid
        status:
          type: string
          enum: [queued, processing, completed, failed]
        createdAt:
          type: string
          format: date-time

    ExportStatus:
      type: object
      properties:
        taskId:
          type: string
          format: uuid
        status:
          type: string
          enum: [queued, processing, completed, failed]
        progress:
          type: integer
        downloadUrl:
          type: string
          format: uri
        expiresAt:
          type: string
          format: date-time
        fileSize:
          type: integer
        error:
          type: string