openapi: 3.0.3
info:
  title: Substrate Platform API
  description: |
    API for the Substrate Platform - a multi-modal knowledge graph platform for architectural governance.
    
    This API provides endpoints for:
    - Graph visualization and analysis
    - Policy management and enforcement
    - Drift detection and violation tracking
    - Search and evidence retrieval
    - System health monitoring
    - UI configuration
  version: 1.0.0
  contact:
    name: Substrate Platform Team
servers:
  - url: /api/v1
    description: Default API server

paths:
  # Graph Endpoints
  /graph/nodes:
    get:
      summary: Get graph nodes
      description: Retrieve nodes from the knowledge graph with optional filtering
      tags:
        - Graph
      parameters:
        - name: type
          in: query
          description: Filter by entity type
          schema:
            type: string
            enum: [Service, API, Module, Database, Component, Team, Repository, Package, Function, Class, Interface, Endpoint, Queue, Cache]
        - name: lens
          in: query
          description: Filter by lens type
          schema:
            type: string
            enum: [reality, intent, drift]
        - name: query
          in: query
          description: Search query for node labels or descriptions
          schema:
            type: string
      responses:
        '200':
          description: List of graph nodes
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/GraphNode'

  /graph/edges:
    get:
      summary: Get graph edges
      description: Retrieve edges from the knowledge graph with optional filtering
      tags:
        - Graph
      parameters:
        - name: from
          in: query
          description: Filter by source node ID
          schema:
            type: string
        - name: to
          in: query
          description: Filter by target node ID
          schema:
            type: string
        - name: lens
          in: query
          description: Filter by lens type
          schema:
            type: string
            enum: [reality, intent, drift]
      responses:
        '200':
          description: List of graph edges
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/GraphEdge'

  /graph/subgraph:
    post:
      summary: Extract subgraph
      description: Extract a subgraph based on starting nodes and depth
      tags:
        - Graph
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubgraphRequest'
      responses:
        '200':
          description: Subgraph data
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/GraphData'

  /graph/communities:
    get:
      summary: Get communities
      description: Retrieve detected communities in the graph
      tags:
        - Graph
      responses:
        '200':
          description: List of communities
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Community'

  /graph/metrics:
    get:
      summary: Get graph metrics
      description: Retrieve various metrics about the graph
      tags:
        - Graph
      responses:
        '200':
          description: Graph metrics
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/GraphMetrics'

  # Policy Endpoints
  /policies:
    get:
      summary: Get all policies
      description: Retrieve all policies with optional filtering
      tags:
        - Policies
      parameters:
        - name: status
          in: query
          description: Filter by policy status
          schema:
            type: string
            enum: [Enforced, Warning, Draft, Disabled]
        - name: severity
          in: query
          description: Filter by severity level
          schema:
            type: string
            enum: [Critical, High, Medium, Low]
      responses:
        '200':
          description: List of policies
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Policy'

    post:
      summary: Create policy
      description: Create a new policy
      tags:
        - Policies
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PolicyCreate'
      responses:
        '201':
          description: Created policy
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Policy'

  /policies/{id}:
    get:
      summary: Get policy by ID
      description: Retrieve a specific policy by its ID
      tags:
        - Policies
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Policy details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Policy'
        '404':
          description: Policy not found

    put:
      summary: Update policy
      description: Update an existing policy
      tags:
        - Policies
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PolicyCreate'
      responses:
        '200':
          description: Updated policy
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Policy'

    delete:
      summary: Delete policy
      description: Delete a policy
      tags:
        - Policies
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Policy deleted

  /policies/{id}/evaluate:
    post:
      summary: Evaluate policy
      description: Evaluate a policy against input data
      tags:
        - Policies
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                input:
                  type: object
      responses:
        '200':
          description: Evaluation result
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/PolicyEvaluationResult'

  /policies/templates:
    get:
      summary: Get policy templates
      description: Retrieve available policy templates
      tags:
        - Policies
      responses:
        '200':
          description: List of policy templates
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PolicyTemplate'

  /policies/metadata:
    get:
      summary: Get policy metadata
      description: Retrieve metadata including status config, severity levels, and enforcement modes
      tags:
        - Policies
      responses:
        '200':
          description: Policy metadata
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/PolicyMetadata'

  # Drift Endpoints
  /drift/violations:
    get:
      summary: Get drift violations
      description: Retrieve drift violations with optional filtering
      tags:
        - Drift
      parameters:
        - name: status
          in: query
          description: Filter by violation status
          schema:
            type: string
            enum: [open, resolved, false_positive, investigating]
        - name: severity
          in: query
          description: Filter by severity
          schema:
            type: string
            enum: [Critical, High, Medium, Low]
      responses:
        '200':
          description: List of violations
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DriftViolation'

  /drift/violations/{id}:
    get:
      summary: Get violation by ID
      description: Retrieve a specific violation
      tags:
        - Drift
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Violation details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/DriftViolation'

  /drift/violations/{id}/resolve:
    post:
      summary: Resolve violation
      description: Mark a violation as resolved
      tags:
        - Drift
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ViolationResolution'
      responses:
        '200':
          description: Resolved violation
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/DriftViolation'

  /drift/summary:
    get:
      summary: Get drift summary
      description: Retrieve summary statistics about drift violations
      tags:
        - Drift
      responses:
        '200':
          description: Drift summary
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/DriftSummary'

  /drift/timeline:
    get:
      summary: Get drift timeline
      description: Retrieve timeline of drift violations
      tags:
        - Drift
      parameters:
        - name: from
          in: query
          required: true
          description: Start date (ISO 8601)
          schema:
            type: string
            format: date
        - name: to
          in: query
          required: true
          description: End date (ISO 8601)
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Drift timeline
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DriftTimelinePoint'

  # Search Endpoints
  /search:
    post:
      summary: Search
      description: Perform semantic search across the knowledge graph
      tags:
        - Search
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchRequest'
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/SearchResponse'

  /search/evidence:
    get:
      summary: Get evidence
      description: Retrieve evidence for a search result
      tags:
        - Search
      parameters:
        - name: resultId
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Evidence items
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/EvidenceItem'

  /search/reasoning:
    get:
      summary: Get reasoning results
      description: Retrieve reasoning/analysis results
      tags:
        - Search
      responses:
        '200':
          description: Reasoning results
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ReasoningResult'

  # Sync Endpoints
  /sync:
    post:
      summary: Trigger sync
      description: Trigger a synchronization job
      tags:
        - Sync
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SyncRequest'
      responses:
        '200':
          description: Sync job started
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/SyncJob'

  /sync/{id}/status:
    get:
      summary: Get sync status
      description: Retrieve status of a sync job
      tags:
        - Sync
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Sync job status
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/SyncJob'

  # Health Endpoints
  /health:
    get:
      summary: Check health
      description: Check system health status
      tags:
        - Health
      responses:
        '200':
          description: Health status
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/HealthStatus'

  /health/metrics/dashboard:
    get:
      summary: Get dashboard metrics
      description: Retrieve metrics for the dashboard
      tags:
        - Health
      responses:
        '200':
          description: Dashboard metrics
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/DashboardMetrics'

  # UI Config Endpoints
  /ui-config/lens:
    get:
      summary: Get lens configuration
      description: Retrieve lens configuration for the UI
      tags:
        - UI Config
      responses:
        '200':
          description: Lens configuration
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    additionalProperties:
                      $ref: '#/components/schemas/LensConfig'

  /ui-config/legend:
    get:
      summary: Get legend items
      description: Retrieve legend items for the UI
      tags:
        - UI Config
      responses:
        '200':
          description: Legend items
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/LegendItemConfig'

  /ui-config/actions/analysis:
    get:
      summary: Get analysis actions
      description: Retrieve analysis actions for the UI
      tags:
        - UI Config
      responses:
        '200':
          description: Analysis actions
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    additionalProperties:
                      type: array
                      items:
                        $ref: '#/components/schemas/AnalysisAction'

  /ui-config/actions/drift:
    get:
      summary: Get drift actions
      description: Retrieve drift resolution actions for the UI
      tags:
        - UI Config
      responses:
        '200':
          description: Drift actions
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/AnalysisAction'

  # Memory Endpoints
  /memory/audit:
    get:
      summary: Get audit items
      description: Retrieve audit items from the memory layer
      tags:
        - Memory
      responses:
        '200':
          description: List of audit items
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/AuditItem'

  /memory/audit/{id}:
    get:
      summary: Get audit item by ID
      description: Retrieve a specific audit item
      tags:
        - Memory
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Audit item details
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/AuditItem'

components:
  schemas:
    # Graph Schemas
    Position:
      type: object
      properties:
        x:
          type: number
        y:
          type: number
      required: [x, y]

    NodeColors:
      type: object
      properties:
        reality:
          type: string
        intent:
          type: string
        drift:
          type: string
      required: [reality, intent, drift]

    NodeMetrics:
      type: object
      properties:
        coupling:
          type: object
          properties:
            afferent:
              type: number
            efferent:
              type: number
            instability:
              type: number
        cohesion:
          type: number
        complexity:
          type: number

    GraphNode:
      type: object
      properties:
        id:
          type: string
        label:
          type: string
        type:
          type: string
          enum: [Service, API, Module, Database, Component, Team, Repository, Package, Function, Class, Interface, Endpoint, Queue, Cache]
        position:
          $ref: '#/components/schemas/Position'
        colors:
          $ref: '#/components/schemas/NodeColors'
        icon:
          type: string
        altIcon:
          type: string
        metadata:
          type: object
          additionalProperties: true
        metrics:
          $ref: '#/components/schemas/NodeMetrics'
      required: [id, label, type, position, colors, icon]

    GraphEdge:
      type: object
      properties:
        id:
          type: string
        from:
          type: string
        to:
          type: string
        type:
          type: string
        color:
          type: string
        width:
          type: number
        dashed:
          type: string
        animate:
          type: boolean
        isViolation:
          type: boolean
        lens:
          type: array
          items:
            type: string
            enum: [reality, intent, drift]
        always:
          type: boolean
        opacityInDrift:
          type: number
        metadata:
          type: object
          additionalProperties: true
      required: [from, to, color, width]

    GraphData:
      type: object
      properties:
        nodes:
          type: array
          items:
            $ref: '#/components/schemas/GraphNode'
        edges:
          type: array
          items:
            $ref: '#/components/schemas/GraphEdge'
      required: [nodes, edges]

    SubgraphRequest:
      type: object
      properties:
        nodeIds:
          type: array
          items:
            type: string
        depth:
          type: number
          default: 2
        includeMetadata:
          type: boolean
      required: [nodeIds]

    Community:
      type: object
      properties:
        id:
          type: string
        level:
          type: number
        nodeCount:
          type: number
        density:
          type: number
        summary:
          type: string
        nodes:
          type: array
          items:
            type: string
      required: [id, level, nodeCount, density, summary, nodes]

    GraphMetrics:
      type: object
      properties:
        totalNodes:
          type: number
        totalEdges:
          type: number
        communities:
          type: number
        avgClustering:
          type: number
        conformanceScore:
          type: number
        couplingMetrics:
          type: object
          properties:
            avgAfferent:
              type: number
            avgEfferent:
              type: number
            avgInstability:
              type: number
        healthScore:
          type: object
          properties:
            overall:
              type: number
            architectural:
              type: number
            documentation:
              type: number
            codeQuality:
              type: number
      required: [totalNodes, totalEdges, communities, avgClustering, conformanceScore]

    # Policy Schemas
    PolicyMetadata:
      type: object
      properties:
        author:
          type: string
        created:
          type: string
          format: date
        updated:
          type: string
          format: date
        tags:
          type: array
          items:
            type: string
      required: [author, created, updated, tags]

    PolicyEnforcement:
      type: object
      properties:
        mode:
          type: string
          enum: [Strict, Warn, DryRun]
        scope:
          type: array
          items:
            type: string
        autoRemediate:
          type: boolean
      required: [mode, scope, autoRemediate]

    Policy:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        package:
          type: string
        status:
          type: string
          enum: [Enforced, Warning, Draft, Disabled]
        severity:
          type: string
          enum: [Critical, High, Medium, Low]
        rules:
          type: number
        violations:
          type: number
        rego:
          type: string
        regoKey:
          type: string
        metadata:
          $ref: '#/components/schemas/PolicyMetadata'
        enforcement:
          $ref: '#/components/schemas/PolicyEnforcement'
      required: [id, name, description, package, status, severity, rules, violations, metadata, enforcement]

    PolicyCreate:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        package:
          type: string
        severity:
          type: string
          enum: [Critical, High, Medium, Low]
        rego:
          type: string
        metadata:
          type: object
        enforcement:
          type: object
      required: [name, description, package, severity]

    PolicyTemplate:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        category:
          type: string
        rego:
          type: string
      required: [id, name, description, category, rego]

    PolicyEvaluationResult:
      type: object
      properties:
        allowed:
          type: boolean
        violations:
          type: array
          items:
            type: string
        details:
          type: object
          additionalProperties: true
      required: [allowed, violations]

    PolicyMetadataConfig:
      type: object
      properties:
        statusConfig:
          type: object
          additionalProperties:
            type: object
            properties:
              color:
                type: string
              icon:
                type: string
              description:
                type: string
        severityLevels:
          type: object
          additionalProperties:
            type: object
            properties:
              color:
                type: string
              value:
                type: number
        enforcementModes:
          type: object
          additionalProperties:
            type: string

    # Drift Schemas
    SuggestedAction:
      type: object
      properties:
        id:
          type: string
        label:
          type: string
        icon:
          type: string
        description:
          type: string
      required: [id, label, icon, description]

    DriftViolation:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [jira, doc, pr, owner, dependency, policy]
        title:
          type: string
        description:
          type: string
        severity:
          type: string
          enum: [Critical, High, Medium, Low]
        status:
          type: string
          enum: [open, resolved, false_positive, investigating]
        highlight:
          type: boolean
        between:
          type: array
          items:
            type: string
        policy:
          type: string
        details:
          type: object
          properties:
            issue:
              type: string
            impact:
              type: string
            detectedAt:
              type: string
              format: date-time
            detectedBy:
              type: string
            location:
              type: object
              properties:
                file:
                  type: string
                line:
                  type: number
                function:
                  type: string
        suggestedActions:
          type: array
          items:
            $ref: '#/components/schemas/SuggestedAction'
        createdAt:
          type: string
          format: date-time
        resolvedAt:
          type: string
          format: date-time
      required: [id, type, title, description, severity, status, highlight, suggestedActions]

    DriftSummary:
      type: object
      properties:
        totalViolations:
          type: number
        bySeverity:
          type: object
          additionalProperties:
            type: number
        byType:
          type: object
          additionalProperties:
            type: number
        trend:
          type: string
          enum: [improving, stable, worsening]
      required: [totalViolations, bySeverity, byType, trend]

    DriftTimelinePoint:
      type: object
      properties:
        date:
          type: string
          format: date
        newViolations:
          type: number
        resolvedViolations:
          type: number
        totalOpen:
          type: number
      required: [date, newViolations, resolvedViolations, totalOpen]

    ViolationResolution:
      type: object
      properties:
        strategy:
          type: string
          enum: [update_intent, refactor_reality, false_positive]
        reason:
          type: string
        ticketId:
          type: string
      required: [strategy, reason]

    # Search Schemas
    SearchRequest:
      type: object
      properties:
        query:
          type: string
        mode:
          type: string
          enum: [local, global, drift]
        filters:
          type: object
          properties:
            entityTypes:
              type: array
              items:
                type: string
            dateRange:
              type: object
              properties:
                from:
                  type: string
                  format: date
                to:
                  type: string
                  format: date
        limit:
          type: number
      required: [query]

    SearchResult:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
        type:
          type: string
        score:
          type: number
        entityId:
          type: string
        metadata:
          type: object
          additionalProperties: true
      required: [id, title, description, type, score, entityId]

    SearchResponse:
      type: object
      properties:
        query:
          type: string
        mode:
          type: string
        results:
          type: array
          items:
            $ref: '#/components/schemas/SearchResult'
        total:
          type: number
        took:
          type: number
      required: [query, mode, results, total, took]

    EvidenceItem:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [adr, source, policy, graph, pr, jira]
        label:
          type: string
        title:
          type: string
        description:
          type: string
        content:
          type: string
        source:
          type: string
        language:
          type: string
        line:
          type: number
        confidence:
          type: number
      required: [id, type, label, title, description, content, source, confidence]

    ReasoningResult:
      type: object
      properties:
        id:
          type: string
        query:
          type: string
        summary:
          type: string
        analysis:
          type: string
        services:
          type: array
          items:
            type: string
        severity:
          type: string
        evidenceIds:
          type: array
          items:
            type: string
      required: [id, query, summary, analysis, services, severity, evidenceIds]

    # Sync Schemas
    SyncRequest:
      type: object
      properties:
        type:
          type: string
          enum: [reality, intent, full]
        sources:
          type: array
          items:
            type: string
        options:
          type: object
          properties:
            incremental:
              type: boolean
            force:
              type: boolean
      required: [type]

    SyncJob:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [reality, intent, full]
        status:
          type: string
          enum: [pending, running, completed, failed]
        progress:
          type: number
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        error:
          type: string
        stats:
          type: object
          properties:
            entitiesProcessed:
              type: number
            entitiesCreated:
              type: number
            entitiesUpdated:
              type: number
      required: [id, type, status, progress]

    # Health Schemas
    HealthCheck:
      type: object
      properties:
        name:
          type: string
        status:
          type: string
          enum: [pass, fail, warn]
        responseTime:
          type: number
        message:
          type: string
      required: [name, status, responseTime]

    HealthStatus:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        version:
          type: string
        uptime:
          type: number
        checks:
          type: array
          items:
            $ref: '#/components/schemas/HealthCheck'
      required: [status, version, uptime, checks]

    ActivityItem:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
        title:
          type: string
        timestamp:
          type: string
          format: date-time
        metadata:
          type: object
          additionalProperties: true
      required: [id, type, title, timestamp]

    DashboardMetrics:
      type: object
      properties:
        systemHealth:
          $ref: '#/components/schemas/HealthStatus'
        graphMetrics:
          $ref: '#/components/schemas/GraphMetrics'
        driftSummary:
          $ref: '#/components/schemas/DriftSummary'
        policyStats:
          type: object
          properties:
            total:
              type: number
            enforced:
              type: number
            violations:
              type: number
        recentActivity:
          type: array
          items:
            $ref: '#/components/schemas/ActivityItem'
      required: [systemHealth, graphMetrics, driftSummary, policyStats, recentActivity]

    # UI Config Schemas
    LensConfig:
      type: object
      properties:
        label:
          type: string
        color:
          type: string
        bgColor:
          type: string
        accentColor:
          type: string
        description:
          type: string
        summary:
          type: string
        metrics:
          type: object
          properties:
            entities:
              type: number
            score:
              type: string
            scoreLabel:
              type: string
            subCount:
              type: number
            subLabel:
              type: string
        violation:
          type: object
          properties:
            policy:
              type: string
            between:
              type: array
              items:
                type: string
            description:
              type: string
      required: [label, color, bgColor, accentColor, description, summary]

    LegendItemConfig:
      type: object
      properties:
        id:
          type: string
        color:
          type: string
        label:
          type: string
        dashed:
          type: boolean
        lenses:
          type: array
          items:
            type: string
            enum: [reality, intent, drift]
      required: [id, color, label, lenses]

    AnalysisAction:
      type: object
      properties:
        id:
          type: string
        icon:
          type: string
        label:
          type: string
        description:
          type: string
        color:
          type: string
      required: [id, icon, label, description, color]

    # Memory Schemas
    AuditItem:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [jira, doc, pr, owner]
        title:
          type: string
        desc:
          type: string
        highlight:
          type: boolean
        details:
          type: object
          properties:
            issue:
              type: string
            summary:
              type: string
            problem:
              type: string
            impact:
              type: string
            document:
              type: string
            title:
              type: string
            lastUpdated:
              type: string
            driftMetrics:
              type: object
              properties:
                filesCompliant:
                  type: number
                filesDrifted:
                  type: number
                complianceRate:
                  type: string
            pr:
              type: string
            author:
              type: string
            conflicts:
              type: array
              items:
                type: object
            component:
              type: string
            previousOwner:
              type: string
            domain:
              type: string
            riskLevel:
              type: string
            pendingItems:
              type: object
              properties:
                criticalBugs:
                  type: number
                openPRs:
                  type: number
                untriagedIssues:
                  type: number
            suggestedActions:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                  label:
                    type: string
                  icon:
                    type: string
                  description:
                    type: string
      required: [id, type, title, desc, highlight, details]

    # Error Response
    Error:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: object
          additionalProperties: true
      required: [code, message]
